<!DOCTYPE html>
<!-- saved from url=(0251)https://software-%2Ddl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&_x_tr_tl=zh-CN&_x_tr_hl=en&_x_tr_pto=wapp#ctescanovs-var -->
<html class="no-js translated-ltr" lang="zh-CN"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <!--<base href="https://software-dl.ti.com/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html">--><base href=".">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档</title>
  <link rel="shortcut icon" href="https://software-dl.ti.com/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/_static/favicon.ico">
  <link rel="stylesheet" href="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/theme.css" type="text/css">
  <link rel="stylesheet" href="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/theme_overrides.css" type="text/css">
  <link rel="stylesheet" href="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/custom.css" type="text/css">
  <link rel="index" title="指数" href="https://software-dl.ti.com/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/genindex.html">
  <link rel="search" title="搜索" href="https://software-dl.ti.com/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/search.html">
  <link rel="top" title="
SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南文档" href="https://software-dl.ti.com/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/index.html">
  <link rel="next" title="微型 BLE 堆栈" href="https://software-dl.ti.com/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/u-stack-index.html">
  <link rel="prev" title="TI 提供的电路板文件" href="https://software-dl.ti.com/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x/custom-hardware.html">
  <script type="text/javascript" async="" charset="utf-8" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/19c369a85be168c883cbae6664876759.js.下载" id="utag_246"></script><script type="text/javascript" async="" charset="utf-8" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/js" id="utag_318"></script><script src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/utag.js.下载" type="text/javascript" async=""></script><script type="text/javascript" async="" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/metrics-min.js.下载"></script><script language="JavaScript">
        var tiPageName;
        tiPageName = "sug ble-stack-3.x-guide localization-index";

        if (location.protocol == "file:"){
            var ci_analytics_poc_load = true;
        }
    </script>
  <script src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/analytics.js.下载" type="text/javascript" charset="utf-8">



  
  <script src="../_static/js/modernizr.min.js"></script>
  <meta http-equiv="X-Translated-By" content="Google">
  <meta http-equiv="X-Translated-To" content="zh-CN">
  <script type="text/javascript" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/m=corsproxy" data-sourceurl="https://software-dl.ti.com/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html"></script>
  <link href="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/css2" rel="stylesheet">
  <script type="text/javascript" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/m=phishing_protection" data-phishing-protection-enabled="false" data-forms-warning-enabled="true" data-source-url="https://software-dl.ti.com/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html"></script>
  <meta name="robots" content="none">
 <script async="" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/lazy.min.js.下载"></script><script type="text/javascript" async="" charset="utf-8" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/utag.318.js.下载" id="utag_ti.main_318"></script><link type="text/css" rel="stylesheet" charset="UTF-8" href="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/m=el_main_css"><script type="text/javascript" charset="UTF-8" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/m=el_main"></script><script type="text/javascript" async="" charset="utf-8" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/utag.246.js.下载" id="utag_ti.main_246"></script><link charset="utf-8" rel="preload" as="script" href="https://try.abtasty.com/shared/me.160b8ec1f1f86ac5f6af.js"></head>
 <body class="wy-body-for-nav" role="document" style="margin-top: 56px;"><iframe title="谷歌翻译导航" frameborder="0" id="gt-nvframe" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/websitetranslationui.html" style="border: none; border-radius: 0px; box-shadow: none; height: 57px; left: 0px; right: auto; position: fixed; top: 0px; transition: none; width: 100%; z-index: 2147483646;"></iframe>
  <script type="text/javascript" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/m=navigationui" data-environment="prod" data-proxy-url="https://software--dl-ti-com.translate.goog" data-proxy-full-url="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp" data-source-url="https://software-dl.ti.com/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html" data-source-language="auto" data-target-language="zh-CN" data-display-language="en" data-detected-source-language="en" data-is-source-untranslated="false" data-source-untranslated-url="https://translate.google.com/website?sl=auto&amp;tl=zh-CN&amp;hl=en&amp;client=webapp&amp;u=https://software-dl.ti.com/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html&amp;anno=2" data-client="webapp"></script>
  <header id="tiHeader">
   <div class="top">
    <ul>
     <li id="top_logo"><a href="https://translate.google.com/website?sl=auto&amp;tl=zh-CN&amp;hl=en&amp;client=webapp&amp;u=https://www.ti.com"> <img src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/ti_logo.png"> </a></li>
    </ul>
   </div>
   <div class="nav"></div>
  </header>
  <div class="wy-grid-for-nav">
   <nav data-toggle="wy-nav-shift" class="wy-nav-side" style="top: 0px;">
    <div class="wy-side-scroll">
     <div class="wy-side-nav-search"><a href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp" class="icon icon-home"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用于 BLE-Stack 3.xx 的 SimpleLink™ CC2640R2 SDK 用户指南</font></font></a>
      <div class="version"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       3.03.01.00
      </font></font></div>
      <div role="search">
       <form id="rtd-search-form" class="wy-form" action="https://software-dl.ti.com/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/search.html" method="get"><input type="text" name="q" placeholder="搜索文档"> <input type="hidden" name="check_keywords" value="yes"> <input type="hidden" name="area" value="default">
       </form>
      </div>
     </div>
     <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="主导航">
      <ul class="current">
       <li class="toctree-l1"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/disclaimer.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">免责声明</font></font></a></li>
       <li class="toctree-l1"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/get-started.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入门</font></font></a></li>
       <li class="toctree-l1"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/platform.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CC2640R2F SDK 平台</font></font></a></li>
       <li class="toctree-l1"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/tirtos-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TI-RTOS（RTOS 内核）概述</font></font></a></li>
       <li class="toctree-l1"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/ble-stack-3-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用</font></font></a></li>
       <li class="toctree-l1"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/ble-stack-3-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#ble-stack"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BLE 协议栈</font></font></a></li>
       <li class="toctree-l1"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/ble-stack-3-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#developing-a-custom-application"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开发自定义应用程序</font></font></a></li>
       <li class="toctree-l1"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/ble-stack-3-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#ble-network-processor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BLE 网络处理器</font></font></a></li>
       <li class="toctree-l1"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/ble-stack-3-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#running-the-sdk-on-custom-hardware"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在定制硬件上运行 SDK</font></font></a></li>
       <li class="toctree-l1 current"><a class="current reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#"><span class="toctree-expand"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 工具箱</font></font></a>
        <ul>
         <li class="toctree-l2"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#general-rtls-software-architecture"><span class="toctree-expand"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通用 RTLS 软件架构</font></font></a>
          <ul>
           <li class="toctree-l3"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 工具箱</font></font></a></li>
           <li class="toctree-l3"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#rtls-utility"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 实用程序</font></font></a></li>
           <li class="toctree-l3"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#rtls-node-manager"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 节点管理器</font></font></a></li>
           <li class="toctree-l3"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#rtls-control-module"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 控制模块</font></font></a></li>
           <li class="toctree-l3"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#rtls-roles-and-topology"><span class="toctree-expand"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 角色和拓扑</font></font></a>
            <ul>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#master"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">掌握</font></font></a></li>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#slave"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">奴隶</font></font></a></li>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#passive"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被动的</font></font></a></li>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#pc-central-processing-node"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PC/中央处理节点</font></font></a></li>
            </ul></li>
           <li class="toctree-l3"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#role-combinations"><span class="toctree-expand"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">角色组合</font></font></a>
            <ul>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#ble-stack"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BLE 协议栈</font></font></a></li>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#tof"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">飞行时间</font></font></a></li>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#aoa"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">迎角</font></font></a></li>
            </ul></li>
           <li class="toctree-l3"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#rtls-driver"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 驱动程序</font></font></a></li>
           <li class="toctree-l3"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#physical-considerations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物理考虑</font></font></a></li>
          </ul></li>
         <li class="toctree-l2"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#rssi-based-localization"><span class="toctree-expand"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于 RSSI 的定位</font></font></a>
          <ul>
           <li class="toctree-l3"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#reading-rssi"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读取 RSSI</font></font></a></li>
           <li class="toctree-l3"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接监视器</font></font></a></li>
           <li class="toctree-l3"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#ble-5-stack"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BLE(5)-协议栈</font></font></a></li>
          </ul></li>
         <li class="toctree-l2"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#angle-of-arrival"><span class="toctree-expand"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到达角</font></font></a>
          <ul>
           <li class="toctree-l3"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#packet-format"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据包格式</font></font></a></li>
           <li class="toctree-l3"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#integration"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一体化</font></font></a></li>
           <li class="toctree-l3"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#aoa-driver"><span class="toctree-expand"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AoA 驱动程序</font></font></a>
            <ul>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#data-collection-flow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据收集流程</font></font></a></li>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#gptimer-delay-tuning"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GPTimer 延迟调整</font></font></a></li>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#antenna-switching"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">天线切换</font></font></a></li>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#convert-i-q-data-to-angle-difference"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将 I/Q 数据转换为角度差</font></font></a></li>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#valid-i-q-samples-for-angle-calculation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于角度计算的有效 I/Q 样本</font></font></a></li>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#angle-compensation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">角度补偿</font></font></a></li>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#aoa-functions-overview"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AoA 功能概述</font></font></a></li>
            </ul></li>
           <li class="toctree-l3"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#aoa-application-overview"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AoA 应用程序概述</font></font></a></li>
          </ul></li>
         <li class="toctree-l2"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#time-of-flight"><span class="toctree-expand"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">飞行时间</font></font></a>
          <ul>
           <li class="toctree-l3"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#theory-of-operation"><span class="toctree-expand"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作原理</font></font></a>
            <ul>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#terminology"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">术语</font></font></a></li>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据包格式</font></font></a></li>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#tof-roles"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 角色</font></font></a></li>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#tof-protocol"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 协议</font></font></a></li>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#resolution"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解决</font></font></a></li>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#accuracy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">准确性</font></font></a></li>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#tof-time-slot-and-frequency-hopping"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 时隙和跳频</font></font></a></li>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#link-quality-indication-lqi-and-multi-path-filtering"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链路质量指示 (LQI) 和多路径过滤</font></font></a></li>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#security"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全</font></font></a></li>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#tof-multinode-synchronization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 多节点同步</font></font></a></li>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#tof-role-switching"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 角色切换</font></font></a></li>
            </ul></li>
           <li class="toctree-l3"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#tof-driver"><span class="toctree-expand"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 驱动器</font></font></a>
            <ul>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#initialize"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始化</font></font></a></li>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#run"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">跑步</font></font></a></li>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#collect-the-results"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收集结果</font></font></a></li>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#calibrate"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">校准</font></font></a></li>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#application"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用</font></font></a></li>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#debug-statistics"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试统计</font></font></a></li>
            </ul></li>
           <li class="toctree-l3"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#rtlsctrl-for-time-of-flight"><span class="toctree-expand"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLSCtrl 用于飞行时间</font></font></a>
            <ul>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#tof-parameters"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 参数</font></font></a></li>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#role-switch"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">角色转换</font></font></a></li>
             <li class="toctree-l4"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#calibration"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">校准</font></font></a></li>
            </ul></li>
           <li class="toctree-l3"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#interleaving-with-bluetooth"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与蓝牙交错</font></font></a></li>
          </ul></li>
        </ul></li>
       <li class="toctree-l1"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/u-stack-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微型 BLE 堆栈</font></font></a></li>
       <li class="toctree-l1"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-common/npi-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络处理器接口 (NPI)</font></font></a></li>
       <li class="toctree-l1"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/index-oad-cc2640.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无线下载 (OAD)</font></font></a></li>
       <li class="toctree-l1"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/voice/voice.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建支持语音的应用程序</font></font></a></li>
       <li class="toctree-l1"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/secure-fw-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全固件 (SFW)</font></font></a></li>
       <li class="toctree-l1"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/sensor-controller/sensor-controller.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传感器控制器</font></font></a></li>
       <li class="toctree-l1"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/debugging-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试</font></font></a></li>
       <li class="toctree-l1"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/migration.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">迁移指南</font></font></a></li>
       <li class="toctree-l1"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/api-reference.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API 参考</font></font></a></li>
       <li class="toctree-l1"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/reference.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">术语和定义</font></font></a></li>
      </ul>
     </div>
    </div>
   </nav>
   <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <nav class="wy-nav-top" role="navigation" aria-label="顶部导航"><i data-toggle="wy-nav-top" class="fa fa-bars"></i> <a href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用于 BLE-Stack 3.xx 的 SimpleLink™ CC2640R2 SDK 用户指南</font></font></a>
    </nav>
    <div class="wy-nav-content">
     <div class="rst-content">
      <div role="navigation" aria-label="面包屑导航">
       <ul class="wy-breadcrumbs">
        <li><a href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文档</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">»</font></font></li>
        <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 工具箱</font></font></li>
        <li class="wy-breadcrumbs-aside"></li>
       </ul>
       <hr>
      </div>
      <div role="main" class="document" itemscope="" itemtype="http://schema.org/Article">
       <div itemprop="articleBody">
        <div class="section" id="rtls-toolbox">
         <h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 工具箱</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#rtls-toolbox" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h1>
         <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS（实时定位系统）工具箱是一系列 RTLS 技术，可在 TI 的 CC26xx 系列标准低功耗蓝牙无线电上实现。这些技术提供原始数据，可用于开发定位算法和保护其他低功耗蓝牙节点的范围。RTLS 工具箱中包含的三种主要技术是 RSSI、到达角和 TI 飞行时间。</font></font></p>
         <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RSSI 详细说明了传入信号的接收信号强度指示，通常用于通过定位算法中的三边测量过程来推导接收器和发射器之间的距离。低功耗蓝牙堆栈使开发人员能够接收传入蓝牙数据包的 RSSI。</font></font></p>
         <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到达角 (AoA) 是一种用于查找传入蓝牙数据包来源方向的技术，可为三角测量奠定基础。设备对传入的恒定音调进行采样并将其作为 I/Q 数据。此原始 I/Q 数据表示信号的幅度和相位数据，此数据可用于得出设备传输恒定音调的角度。TI 在 CC2640R2F 上的 AoA 解决方案</font></font><a class="reference external" href="https://translate.google.com/website?sl=auto&amp;tl=zh-CN&amp;hl=en&amp;client=webapp&amp;u=https://www.ti.com/product/CC2640R2F"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">专有的，仅供评估使用。</font></font></p>
         <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TI 飞行时间是一种专有技术，用于通过测量 RF 数据包交换的往返延迟来限制设备的安全范围。通过进行多次采样，可以提取出更准确的结果，为开发人员提供数据来帮助对设备进行三边测量。</font></font></p>
         <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用 RTLS 工具箱提供的原始数据，TI 可以帮助开发人员提供更多可用于三边测量和三角测量的数据，从而改进基于蓝牙技术的定位算法。</font></font></p>
         <p><font style="vertical-align: inherit;"></font><a class="reference external" href="https://translate.google.com/website?sl=auto&amp;tl=zh-CN&amp;hl=en&amp;client=webapp&amp;u=https://www.ti.com/product/CC2640R2F"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CC2640R2F</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> RF 核心的固有灵活性</font><font style="vertical-align: inherit;">使这一功能得到了显著扩展。使用</font></font><a class="reference external" href="https://translate.google.com/website?sl=auto&amp;tl=zh-CN&amp;hl=en&amp;client=webapp&amp;u=https://www.ti.com/product/CC2640R2F"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CC2640R2F</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的主要优势在于，客户可以开始添加 RTLS 功能和安全性，而几乎不需要额外成本，也几乎不需要额外能耗，也不会增加峰值功率。</font></font></p>
         <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地化有两种根本不同的方法：</font></font></p>
         <div class="wy-table-responsive"><table border="1" class="docutils">
          <colgroup>
           <col width="50%">
           <col width="50%">
          </colgroup>
          <tbody valign="top">
           <tr class="row-odd">
            <td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">三边测量</font></font></strong></td>
            <td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">三角测量</font></font></strong></td>
           </tr>
           <tr class="row-even">
            <td>
             <div class="first last figure"><img alt="../_images/三边测量.png" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/trilateration.png">
             </div></td>
            <td>
             <div class="first last figure"><img alt="三角测量" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/triangulation.png">
             </div></td>
           </tr>
           <tr class="row-odd">
            <td><p class="first"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">三边测量法可以知道参考节点和目标节点之间的距离。这意味着一个定位器看到的可能位置构成一个圆，因此通常需要三个定位器才能找到一个共同的交叉点。（假设是 2D 场景）</font></font></p><p class="last"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#sec-tof"><span class="std std-ref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">飞行时间</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以让你得到从接收器到发射器的距离。</font></font></p></td>
            <td><p class="first"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">三角测量是指您知道从参考节点到目标节点的方向。这意味着一个定位器看到的可能位置构成一条直线，因此两个节点足以确定一个交叉点。（假设是 2D 场景）</font></font></p><p class="last"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#sec-aoa"><span class="std std-ref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到达角</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给出从接收器到发射器的角度。</font></font></p></td>
           </tr>
          </tbody>
         </table></div>
         <div class="admonition note">
          <p class="first admonition-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">笔记</font></font></p>
          <p class="last"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现有的没有外部控制接口的示例已停用。所有 RTLS 示例现在都有外部控制接口。</font></font></p>
         </div>
         <div class="section" id="general-rtls-software-architecture"><span id="sec-rtls-sw-architecture"></span>
          <h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通用 RTLS 软件架构</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#general-rtls-software-architecture" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h2>
          <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下图显示了 RTLS 软件架构。</font></font></p>
          <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于有多个节点收集定位数据，因此拥有一个支持控制这些节点的架构非常重要。它必须能够配置和触发定位，并且必须能够检索定位数据。我们通过重用我们的网络处理器接口 (NPI) 来实现这一点。它基本上是一种通过串行接口支持远程过程调用 (RPC) 的方法。请注意，该架构使得可以用您自己喜欢的串行协议替换 NPI。</font></font></p>
          <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的示例中，我们使用 UART 作为串行传输层。这是因为它在主机 PC 上可作为 UART 通过 USB 轻松使用，并且我们的 LaunchPad 包含一个 UART 到 USB 桥接器。除了嵌入式示例外，我们还提供 PC 软件作为主机，以控制、检索和呈现定位数据。这还可以更快地进行客户性能表征以及重要参数的配置，更不用说开发和测试更高级别的后处理算法的能力了。</font></font></p><img alt="../_images/ditaa-65b5a45447a07f5af551f05671ca32e4722e1268.png" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/ditaa-65b5a45447a07f5af551f05671ca32e4722e1268.png">
          <div class="section" id="id3">
           <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 工具箱</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id3" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 工具箱是一套用于定位用例的软件。下表总结了工具箱中的每个软件组件及其定位应用程序。以下软件组件将在嵌入式节点上运行。</font></font></p>
           <div class="wy-table-responsive"><table border="1" class="docutils">
            <colgroup>
             <col width="33%">
             <col width="67%">
            </colgroup>
            <thead valign="bottom">
             <tr class="row-odd">
              <th class="head"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">软件组件</font></font></th>
              <th class="head"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用法</font></font></th>
             </tr>
            </thead>
            <tbody valign="top">
             <tr class="row-even">
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BLE 协议栈</font></font></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">广告、扫描、连接、交换 RTLS 数据</font></font></td>
             </tr>
             <tr class="row-odd">
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接监视器</font></font></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Micro BLE-Stack 进行 BLE 连接</font></font></td>
             </tr>
             <tr class="row-even">
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到达角</font></font></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于读取 BLE 数据包中嵌入的 AoA 数据的无线电补丁和驱动程序</font></font></td>
             </tr>
             <tr class="row-odd">
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">飞行时间</font></font></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于发送、接收和观察 ToF 交换的无线电贴片和驱动程序</font></font></td>
             </tr>
             <tr class="row-even">
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">统一网络处理器接口 (UNPI)</font></font></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括数据包格式和握手的串行协议，用于节省电力</font></font></td>
             </tr>
             <tr class="row-odd">
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 控制模块</font></font></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现用于在设备之间传递 RTLS 信息的命令和事件集。它在嵌入式设备上运行，并将 UNPI 帧转换为必要的 AoA 和 ToF 函数调用</font></font></td>
             </tr>
            </tbody>
           </table></div>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下表中的软件组件在 PC 上运行。TI 已设置基于 PC 的环境，以便于评估和原型设计各种 RTLS 算法。算法完成后，上述各种 PC 组件可以迁移到嵌入式设备。</font></font></p>
           <div class="wy-table-responsive"><table border="1" class="docutils">
            <colgroup>
             <col width="25%">
             <col width="75%">
            </colgroup>
            <thead valign="bottom">
             <tr class="row-odd">
              <th class="head"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">软件组件</font></font></th>
              <th class="head"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用法</font></font></th>
             </tr>
            </thead>
            <tbody valign="top">
             <tr class="row-even">
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 实用程序</font></font></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">跨节点的事件处理和分发。实现结果队列，并设置工作线程进行数据处理。</font></font></td>
             </tr>
             <tr class="row-odd">
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 节点管理器</font></font></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于从嵌入式设备向 PC 发送和接收 RTLS 命令和事件的框架。实现更高级别的逻辑，例如将必要的 BLE 连接信息转发到连接监视器节点。</font></font></td>
             </tr>
             <tr class="row-even">
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Websocket 服务器</font></font></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现 TCP 套接字的服务器端。旨在通过 UNPI 桥接从节点管理器到 TI GUI 编写器应用程序的串行连接</font></font></td>
             </tr>
             <tr class="row-odd">
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 管理器 GUI 编写器应用程序</font></font></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个简单的 GUI，用于聚合和记录 RTLS 通信并绘制 AoA 或 ToF 数据。它基于 Javascript，在 Web 浏览器中运行</font></font></td>
             </tr>
            </tbody>
           </table></div>
          </div>
          <div class="section" id="rtls-utility">
           <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 实用程序</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#rtls-utility" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTISUtil 模块是建立在节点管理器之上的便利层，可实现 RTLS 网络所需的事件处理和阻止（例如种子分配）。此外，RTLSUTil 模块能够设置工作线程来处理来自设备的结果数据，以及创建队列来存储传入数据。</font></font></p>
          </div>
          <div class="section" id="rtls-node-manager">
           <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 节点管理器</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#rtls-node-manager" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 节点管理器提供以下功能：</font></font></p>
           <ul class="simple">
            <li><font style="vertical-align: inherit;"><a class="reference external" href="https://translate.google.com/website?sl=auto&amp;tl=zh-CN&amp;hl=en&amp;client=webapp&amp;u=https://www.ti.com/product/CC2640R2F"><font style="vertical-align: inherit;">GUI 编辑器与CC2640R2F</font></a><font style="vertical-align: inherit;">之间的桥梁</font></font><a class="reference external" href="https://translate.google.com/website?sl=auto&amp;tl=zh-CN&amp;hl=en&amp;client=webapp&amp;u=https://www.ti.com/product/CC2640R2F"><font style="vertical-align: inherit;"></font></a></li>
            <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保存每个设备的状态并负责配置</font></font></li>
            <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现 RTLS 控制模块和 GUI 编辑器的简便性</font></font></li>
            <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大限度地减少 GUI Composer 与系统其余部分之间的交易量</font></font></li>
           </ul>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于上述功能，节点管理器可以在用户的​​ CPU 上运行并帮助处理慢速总线 (LIN/CAN)。</font></font></p>
          </div>
          <div class="section" id="rtls-control-module">
           <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 控制模块</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#rtls-control-module" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 控制模块是一个作为 RTOS 任务运行的片上模块，它提供以下功能：</font></font></p>
           <ul class="simple">
            <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解析来自节点管理器的命令</font></font></li>
            <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 驱动程序配置和操作</font></font></li>
            <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RF和NPI消息队列</font></font></li>
           </ul>
          </div>
          <div class="section" id="rtls-roles-and-topology">
           <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 角色和拓扑</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#rtls-roles-and-topology" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 网络中的每个节点都以不同的方式利用上面列出的软件组件来执行与定位相关的特定任务。这些功能映射到 RTLS 网络中的角色，并最终由 SDK 中的示例应用程序实现。有三个示例：</font></font><code class="docutils literal notranslate"><span class="pre">rtls_master</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code class="docutils literal notranslate"><span class="pre">rtls_slave</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="docutils literal notranslate"><span class="pre">rtls_passive</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。这些示例的功能如下所述。所有嵌入式节点都实现 UNPI 并充当 UNPI 协议中的从属节点。此外，所有嵌入式节点都实现了 RTLS 控制模块，用于处理来自 UNPI 接口的 RTLS 命令。</font></font></p>
           <div class="admonition note">
            <p class="first admonition-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">笔记</font></font></p>
            <p class="last"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下小节旨在描述 SDK 中的示例应用程序实现了哪些本地化角色。这不是每个节点上可能实现的功能的完整列表，而是示例开箱即用的解释。有关潜在组合的列表，请参阅角色组合。</font></font></p>
           </div>
           <div class="section" id="master">
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">掌握</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#master" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 主设备运行完整的 BLE-Stack 并充当中央设备。它将通过 BLE 扫描并连接到 RTLS 从设备。建立连接后，RTLS 主设备将执行以下操作：</font></font></p>
            <blockquote>
             <div>
              <ul class="simple">
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与 PC 共享连接参数（访问地址、主睡眠时钟精度和 CRC 初始化）。</font></font></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用BLE链路与外围设备共享ToF和AoA参数。</font></font></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现 ToF 主控角色</font></font></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不发送 AoA 数据包，但配置从属设备这样做。</font></font></li>
              </ul>
             </div>
            </blockquote>
           </div>
           <div class="section" id="slave">
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">奴隶</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#slave" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 从设备运行完整的 BLE 堆栈并充当外围设备。这是要定位的设备。从设备将通告并与 RTLS 主设备建立连接。</font></font></p>
            <blockquote>
             <div>
              <ul class="simple">
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用恒定音扩展 (CTE) 发送嵌入 AoA 音的数据包</font></font></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通告要检测的特殊字符串</font></font><code class="docutils literal notranslate"><span class="pre">rtls_master</span></code></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现 ToF 从属角色</font></font></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BLE-Stack 外设角色</font></font></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无线/电池供电，无需连接电脑</font></font></li>
              </ul>
             </div>
            </blockquote>
           </div>
           <div class="section" id="passive">
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被动的</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#passive" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 被动节点不会主动参与 RTLS 主节点和从节点之间的 BLE 连接。相反，它使用连接监控模式下的</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/u-stack-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#sec-index-micro-ble-stack"><span class="std std-ref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Micro BLE Stack</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来跟踪连接。为此，被动设备依靠主节点在建立连接后分发连接参数。被动节点执行以下操作：</font></font></p>
            <blockquote>
             <div>
              <ul class="simple">
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现 ToF 被动角色</font></font></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接收带有 CTE 的数据包并执行同相和正交分量 (IQ) 采样</font></font></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现 Micro BLE-Stack 连接监控应用层。</font><font style="vertical-align: inherit;">有关连接监控的更多信息，请参阅</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/u-stack/functional-description.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#sec-cm-app"><span class="std std-ref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接监控 (CM) 应用程序。</font></font></span></a><font style="vertical-align: inherit;"></font></li>
              </ul>
             </div>
            </blockquote>
           </div>
           <div class="section" id="pc-central-processing-node">
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PC/中央处理节点</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#pc-central-processing-node" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PC 节点负责通过发送命令和处理事件来控制嵌入式 RTLS 节点。在 SDK 中，这是通过实现 UNPI 主角色的 Python 层和将 UNPI 命令转换为浏览器中运行的 GUI Composer 应用程序使用的套接字接口的 websocket 服务器的组合来实现的。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该软件旨在用作从嵌入式节点提取数据的框架，并用它在 PC 上对高级 RTLS 算法进行原型设计。</font></font></p>
            <div class="admonition note">
             <p class="first admonition-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">笔记</font></font></p>
             <p class="last"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在最终产品中，这些算法可能在嵌入式设备甚至 RTLS 主节点上实现。TI 提供了 PC 软件来帮助绘制数据和对各种算法进行原型设计。</font></font></p>
            </div>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PC在Python中实现了以下角色：</font></font></p>
            <blockquote>
             <div>
              <ul class="simple">
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNPI 大师</font></font></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COM 端口接口</font></font></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS UNPI 子系统/命令集的实现</font></font></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Websocket 服务器</font></font></li>
              </ul>
             </div>
            </blockquote>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PC 在 GUI Composer/Javascript 中实现以下角色：</font></font></p>
            <blockquote>
             <div>
              <ul class="simple">
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地主机上的 Websocket 客户端</font></font></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过 websocket 绘制并记录数据</font></font></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解析 JSON 对象以提取 RTLS 数据</font></font></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过 websocket 到 UNPI 转换向 RTLS 节点发出命令</font></font></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举设备</font></font></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将连接参数分发给无源元件</font></font></li>
              </ul>
             </div>
            </blockquote>
           </div>
          </div>
          <div class="section" id="role-combinations">
           <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">角色组合</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#role-combinations" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
           <div class="admonition note">
            <p class="first admonition-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">笔记</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在所有下表（BLE、ToF、AoA）中，列为可选的功能均未由 SDK 中包含的示例应用程序</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但却是用户可以实现的有效且可能的配置。</font></font></p>
            <p class="last"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如：</font></font><code class="docutils literal notranslate"><span class="pre">rtls_master</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以是多角色设备，也</font></font><code class="docutils literal notranslate"><span class="pre">rtls_passive</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以作为 ToF 主机运行。</font></font></p>
           </div>
           <div class="section" id="ble-stack">
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BLE 协议栈</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#ble-stack" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">蓝牙核心规范版本</font></font><a class="reference external" href="https://translate.google.com/website?sl=auto&amp;tl=zh-CN&amp;hl=en&amp;client=webapp&amp;u=https://www.bluetooth.com/specifications/adopted-specifications"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许设备以各种角色以及角色组合的方式运行。下表显示了每个示例的必需功能和可选功能。</font></font></p>
            <div class="wy-table-responsive"><table border="1" class="docutils">
             <colgroup>
              <col width="24%">
              <col width="16%">
              <col width="21%">
              <col width="22%">
              <col width="17%">
             </colgroup>
             <thead valign="bottom">
              <tr class="row-odd">
               <th class="head"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例名称</font></font></th>
               <th class="head"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中央</font></font></th>
               <th class="head"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外围设备</font></font></th>
               <th class="head"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">广播员</font></font></th>
               <th class="head"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">观察者</font></font></th>
              </tr>
             </thead>
             <tbody valign="top">
              <tr class="row-even">
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 大师</font></font></td>
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></td>
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哦</font></font></td>
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哦</font></font></td>
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></td>
              </tr>
              <tr class="row-odd">
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 从属设备</font></font></td>
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哦</font></font></td>
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></td>
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></td>
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哦</font></font></td>
              </tr>
              <tr class="row-even">
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 被动</font></font></td>
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不</font></font></td>
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不</font></font></td>
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哦</font></font></td>
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼吸*</font></font></td>
              </tr>
             </tbody>
            </table></div>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传奇：</font></font></p>
            <blockquote>
             <div>
              <ul class="simple">
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R：必填项</font></font></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O：可选</font></font></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否：不支持</font></font></li>
              </ul>
             </div>
            </blockquote>
            <div class="admonition note">
             <p class="first admonition-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">笔记</font></font></p>
             <p class="last"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上面的 R* 表示，虽然连接监视器能够扫描信标，但还需要连接监视器跟踪连接。蓝牙规范并未正式定义监视角色，但它是 中的一项关键功能</font></font><code class="docutils literal notranslate"><span class="pre">rtls_passive</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
            </div>
           </div>
           <div class="section" id="tof">
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">飞行时间</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#tof" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 角色可以在 RTLS 主设备和 RTLS 被动设备之间轮换。这是一个理想的功能，因为它增加了空间分集，从而使系统更能抵御多径衰落。下表列出了 ToF 的有效配置。</font></font></p>
            <div class="wy-table-responsive"><table border="1" class="docutils">
             <colgroup>
              <col width="28%">
              <col width="24%">
              <col width="22%">
              <col width="26%">
             </colgroup>
             <thead valign="bottom">
              <tr class="row-odd">
               <th class="head"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例名称</font></font></th>
               <th class="head"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF大师</font></font></th>
               <th class="head"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 从属设备</font></font></th>
               <th class="head"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 无源</font></font></th>
              </tr>
             </thead>
             <tbody valign="top">
              <tr class="row-even">
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 大师</font></font></td>
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></td>
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不适用</font></font></td>
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哦</font></font></td>
              </tr>
              <tr class="row-odd">
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 从属设备</font></font></td>
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不适用</font></font></td>
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></td>
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不适用</font></font></td>
              </tr>
              <tr class="row-even">
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 被动</font></font></td>
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></td>
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不适用</font></font></td>
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></td>
              </tr>
             </tbody>
            </table></div>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传奇：</font></font></p>
            <blockquote>
             <div>
              <ul class="simple">
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R：必填项</font></font></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O：可选</font></font></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否：不支持</font></font></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N/A：不适用</font></font></li>
              </ul>
             </div>
            </blockquote>
           </div>
           <div class="section" id="aoa">
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">迎角</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#aoa" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"></font><a class="reference external" href="https://translate.google.com/website?sl=auto&amp;tl=zh-CN&amp;hl=en&amp;client=webapp&amp;u=https://www.bluetooth.com/specifications/adopted-specifications"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">蓝牙核心规范版本 5.1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为连接和无连接 AoA 定义了多种角色。SimpleLink </font></font><a class="reference external" href="https://translate.google.com/website?sl=auto&amp;tl=zh-CN&amp;hl=en&amp;client=webapp&amp;u=https://www.ti.com/tool/SIMPLELINK-CC2640R2-SDK"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CC2640R2 SDK</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的示例支持以下配置</font><font style="vertical-align: inherit;">。</font></font></p>
            <div class="wy-table-responsive"><table border="1" class="docutils">
             <colgroup>
              <col width="31%">
              <col width="22%">
              <col width="47%">
             </colgroup>
             <thead valign="bottom">
              <tr class="row-odd">
               <th class="head"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例名称</font></font></th>
               <th class="head"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发送 CTE</font></font></th>
               <th class="head"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行 IQ 采样</font></font></th>
              </tr>
             </thead>
             <tbody valign="top">
              <tr class="row-even">
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 大师</font></font></td>
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不</font></font></td>
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不</font></font></td>
              </tr>
              <tr class="row-odd">
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 从属设备</font></font></td>
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></td>
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不</font></font></td>
              </tr>
              <tr class="row-even">
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 被动</font></font></td>
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不适用</font></font></td>
               <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></td>
              </tr>
             </tbody>
            </table></div>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传奇：</font></font></p>
            <blockquote>
             <div>
              <ul class="simple">
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R：必填项</font></font></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O：可选</font></font></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否：不支持</font></font></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N/A：不适用</font></font></li>
              </ul>
             </div>
            </blockquote>
           </div>
          </div>
          <div class="section" id="rtls-driver">
           <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 驱动程序</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#rtls-driver" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLS 驱动程序的目的是处理 RTLS 模块的直接调用实现。</font></font></p>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关更多详细信息，请参阅</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#sec-tof-driver"><span class="std std-ref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 驱动程序</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分和</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#sec-aoa-driver"><span class="std std-ref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AoA 驱动程序</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分。</font></font></p>
          </div>
          <div class="section" id="physical-considerations">
           <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物理考虑</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#physical-considerations" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在评估 RTLS 解决方案之前，考虑环境非常重要。所有无线电通信协议都可能受到</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/reference.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#term-multi-path-fading"><span class="xref std std-term"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多径衰落</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的影响，基于 RTLS 的系统也不例外。在评估时控制环境非常重要，或者至少要意识到多径对结果的潜在影响。</font></font></p>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">建议在优化 RF 条件的区域评估 RTLS 解决方案。这包括：</font></font></p>
           <blockquote>
            <div>
             <ul class="simple">
              <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开放空间，无大型金属或混凝土障碍物（柱子、杆子等）</font></font></li>
              <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">干扰源相对较少（例如 Wi-Fi 接入点等）</font></font></li>
              <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用纸板制作的用于节点的高架平台距地面约 1 米。</font></font></li>
             </ul>
            </div>
           </blockquote>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">办公桌环境通常具有次优的射频条件，应尽量避免。</font></font></p>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下图是评估期间建议的节点布局，这是一张 2D 图像，其中所有设备都放置在平面上，如图所示“指向”。在这种情况下，每个节点都应放置在一个盒子上，这样它就不会直接放在地面上。</font></font></p>
           <div class="figure align-center"><img alt="../_images/suggested_layout.png" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/suggested_layout.png">
           </div>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于到达角应用，我们创建了</font></font><a class="reference external" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/www.ti.com/lit/tida029?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">蓝牙到达角天线设计，以进一步解释用户在制作自己的</font></font></a><font style="vertical-align: inherit;"></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/reference.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#term-aoa"><span class="xref std std-term"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AoA</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">板时应该注意什么</font><font style="vertical-align: inherit;">。</font></font></p>
          </div>
         </div>
         <div class="section" id="rssi-based-localization"><span id="sec-rssi-localization"></span>
          <h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于 RSSI 的定位</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#rssi-based-localization" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h2>
          <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RSSI 详细说明了传入信号的接收信号强度指示，是蓝牙中最常用的三边定位方法。TI 低功耗蓝牙堆栈使开发人员能够接收传入蓝牙数据包的 RSSI，并可用于启用 RTLS 算法。</font></font></p>
          <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RSSI 定位基于 Frii</font></font><a class="reference external" href="https://translate.google.com/website?sl=auto&amp;tl=zh-CN&amp;hl=en&amp;client=webapp&amp;u=http://www.antenna-theory.com/basics/friis.php"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传输方程</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。核心概念是接收信号强度与发射节点的距离成正比。下图描述了如何使用 RSSI 来估计距离。</font></font></p>
          <div class="figure" id="id6"><img alt="../_images/friis_equation_illusterated.png" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/friis_equation_illustrated.png">
           <p class="caption"><span class="caption-number"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 76. </font></font></span><span class="caption-text"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Frii 方程</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接收功率和距离之间的关系。</font></font></span></p>
          </div>
          <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然基于 RSSI 的定位是当今 RTLS 系统中最常用的方法，但它也面临着需要克服的挑战：</font></font></p>
          <ul class="simple">
           <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反射和障碍物的存在可能会影响准确性</font></font></li>
           <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无中继攻击保护</font></font></li>
          </ul>
          <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过智能系统设计可以克服 RSSI 的部分挑战。TI 的 RTLS 工具箱使开发人员能够监控主设备和从设备之间的连接，并通过连接监视器从同一数据包获取独立的 RSSI 测量值。这种方法提供了更多数据和参考点，可用于帮助提高 RTLS 应用程序的分辨率。</font></font></p>
          <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于未来的 RTLS 应用，建议将 RSSI 与其他定位技术（如 AoA 或 ToF）相结合，以帮助提高准确性和安全性。</font></font></p>
          <div class="section" id="reading-rssi">
           <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读取 RSSI</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#reading-rssi" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Micro </font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/u-stack-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#sec-index-micro-ble-stack"><span class="std std-ref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BLE Stack</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .（</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/u-stack/functional-description.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#sec-cm-app"><span class="std std-ref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接监视器 (CM) 应用程序</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的基础）和完整的 BLE-Stack 提供 API 来读取接收数据包的 RSSI 信息。以下部分将介绍如何从接收的数据包中提取 RSSI 信息。</font></font></p>
          </div>
          <div class="section" id="id4">
           <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接监视器</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id4" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接监视器将为其跟踪的每个连接保留一个连接信息数组。这包括上次扫描的主从 RSSI。这些字段可以在结构中找到</font></font><code class="docutils literal notranslate"><span class="pre">ubCM_ConnInfo_t</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。字段分别为</font></font><code class="docutils literal notranslate"><span class="pre">rssiMaster</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="docutils literal notranslate"><span class="pre">rssiSlave</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用监控完成回调后（当连接事件的监控扫描完成时），RSSI 信息有效。</font></font></p>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例应用程序</font></font><code class="docutils literal notranslate"><span class="pre">rtls_passive</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">展示了提取从属 RSSI 的示例</font></font><code class="docutils literal notranslate"><span class="pre">RTLSPassive_monitorCompleteEvt</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
          </div>
          <div class="section" id="ble-5-stack">
           <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BLE(5)-协议栈</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#ble-5-stack" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 BLE-Stack 时，</font></font><code class="docutils literal notranslate"><span class="pre">Gap_RegisterConnEventCb</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x/gap.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#gap"><span class="std std-ref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通用访问配置文件 (GAP)</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）将提供来自最后一个连接事件的 RSSI。它可用于中央或外围配置。连接事件回调已经是模块用于</font></font><code class="docutils literal notranslate"><span class="pre">RTLSCtrl</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向 PC/节点管理器报告数据的同步方法。</font><font style="vertical-align: inherit;">有关如何从连接事件回调中提取 RSSI 的信息，请参阅</font></font><a class="reference external" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/doxygen/ble/html/struct_gap___conn_event_rpt__t.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gap_ConnEventRpt_t 。</font></font></a><font style="vertical-align: inherit;"></font></p>
          </div>
         </div>
         <div class="section" id="angle-of-arrival"><span id="sec-aoa"></span>
          <h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到达角</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#angle-of-arrival" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h2>
          <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到达角 (AoA) 是一种用于查找传入蓝牙数据包来源方向的技术，为三角测量奠定基础。</font></font></p>
          <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用具有明确定义属性的天线阵列，接收器将在各个天线之间快速切换，同时测量由于到不同天线的路径长度的微小差异而导致的相移。</font></font></p>
          <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些路径长度差异将取决于传入 RF 波相对于阵列中天线的方向。为了便于相位测量，数据包必须包含一段恒定音调 (CT)，其中没有调制引起的相移。</font></font></p>
          <div class="section" id="packet-format">
           <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据包格式</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#packet-format" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了对φ（相位）进行良好的估计，应该消除信号中所有其他有意的相移。</font></font></p>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">蓝牙核心规范 5.1 版引入了 AoA/AoD（在章节中介绍）</font><font style="vertical-align: inherit;">，它还指定以下状态可以支持发送测向数据包：</font></font><code class="docutils literal notranslate"><span class="pre">Direction</span> <span class="pre">Finding</span> <span class="pre">Using</span> <span class="pre">Bluetooth</span> <span class="pre">Low</span> <span class="pre">Energy</span> <span class="pre">Device</span></code><font style="vertical-align: inherit;"></font></p>
           <ol class="arabic simple">
            <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定期广告；也称为</font></font><code class="docutils literal notranslate"><span class="pre">Connectionless</span> <span class="pre">CTE</span></code></li>
            <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接；也称为</font></font><code class="docutils literal notranslate"><span class="pre">Connection</span> <span class="pre">CTE</span></code></li>
           </ol>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AoA/AoD 和无连接/连接 CTE（恒定音调扩展）背后的理论是相同的，因此，我们将只关注连接 CTE AoA，这是我们目前在</font></font><a class="reference external" href="https://translate.google.com/website?sl=auto&amp;tl=zh-CN&amp;hl=en&amp;client=webapp&amp;u=https://www.ti.com/tool/SIMPLELINK-CC2640R2-SDK"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SimpleLink CC2640R2 SDK中提供的。</font></font></a></p>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先我们来看看有效载荷。通过在连接数据包末尾添加一段连续的 1，有效地以载波频率 + 250kHz 传输单个音调。</font></font></p>
           <blockquote>
            <div>
             <div class="figure align-center"><img alt="../_images/connection_aoa_packet_format.png" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/connection_aoa_packet_format.png">
             </div>
            </div>
           </blockquote>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在报头中，CP位（</font><font style="vertical-align: inherit;">）决定报头是否包含</font><font style="vertical-align: inherit;">。</font></font><code class="docutils literal notranslate"><span class="pre">CTE</span> <span class="pre">Present</span></code><font style="vertical-align: inherit;"></font><code class="docutils literal notranslate"><span class="pre">CTEInfo</span></code><font style="vertical-align: inherit;"></font></p>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code class="docutils literal notranslate"><span class="pre">CTEType</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段</font></font><code class="docutils literal notranslate"><span class="pre">CTEInfo</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进一步指定了这是哪种类型的测向数据包，并且该</font></font><code class="docutils literal notranslate"><span class="pre">CTETime</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段指定了 CTE 的持续时间。</font></font></p>
           <blockquote>
            <div>
             <span id="ctetype-var"></span>
             <div class="wy-table-responsive"><table border="1" class="docutils" id="id7">
              <caption>
               <span class="caption-number"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表 20. </font></font></span><span class="caption-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CTEType 值</font></font></span><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id7" title="此表的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a>
              </caption>
              <colgroup>
               <col width="29%">
               <col width="71%">
              </colgroup>
              <thead valign="bottom">
               <tr class="row-odd">
                <th class="head"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">价值</font></font></th>
                <th class="head"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
               </tr>
              </thead>
              <tbody valign="top">
               <tr class="row-even">
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AoA CTE 包。</font></font></td>
               </tr>
               <tr class="row-odd">
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有 1 µs 槽的 AoD CTE。</font></font></td>
               </tr>
               <tr class="row-even">
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有 2 µs 插槽的 AoD CTE。</font></font></td>
               </tr>
              </tbody>
             </table></div>
            </div>
           </blockquote>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CTETime 的值应在 2~20 之间，并以 8us 为单位进行解释。这意味着当 CTETime 设置为 20 时，连接数据包末尾将有 CTE，持续时间为 8*20 = 160(us)。</font></font></p>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样接收器就有时间首先同步解调器，然后将最后的单音 250kHz 部分的 I 和 Q 样本存储到缓冲区中，然后缓冲区可以由 AoA 应用程序进行后处理</font></font></p>
           <div class="admonition note">
            <p class="first admonition-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">笔记</font></font></p>
            <blockquote>
             <div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              I/Q 数据样本是信号在时间轴上的坐标。事实上，I/Q 数据只是将幅度和相位数据从极坐标系转换到笛卡尔 (X,Y) 坐标系，使用三角学，您可以将极坐标正弦波信息转换为笛卡尔 I/Q 正弦波数据。
             </font></font></div>
            </blockquote>
            <div class="last figure align-center"><img alt="../_images/iq_phasor_diagram.png" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/iq_phasor_diagram.png">
            </div>
           </div>
          </div>
          <div class="section" id="integration"><span id="sec-aoa-integration"></span>
           <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一体化</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#integration" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在接收模式下使用特殊的 RF Core 补丁，来自发射载波频率 + 250kHz 音调的 I 和 Q 样本可由 RF Core 捕获、预处理和缓冲，而不会对主 MCU 造成任何负载。</font></font></p>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于预处理，应用程序可以确定相移，而不必先消除直流偏移或中频，从而显著简化了估计过程，并让应用程序 MCU 可以自由地做更多的事情。</font></font></p>
           <blockquote>
            <div>
             <div class="figure align-center"><img alt="../_images/processing_phase.png" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/processing_phase.png">
             </div>
            </div>
           </blockquote>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I/Q 采样率可配置，最高可达 4 MHz。每个 I/Q 对在无线电 RAM 中占用 32 位空间，无线电 RAM 最多只能存储 2KB（2048 字节）。</font></font></p>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，如果采样率为 4MHz，则每 4us 就会有 16 个 I/Q 对，相当于每 4us 16 * 4（一个 I/Q 对占用 4 个字节空间）= 64 个字节。</font></font></p>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这意味着即使 CTE 长度为 160us，采样率为 4MHz，无线电 RAM 也只能存储 128us 的 I/Q 数据。为了确保 I/Q 样本一直被捕获到音调结束，我们应该考虑降低采样率以覆盖这种情况。有关采样率的更多信息，请参见表</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#ctescanovs-var"><span class="std std-numref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
           <div class="admonition note">
            <p class="first admonition-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">笔记</font></font></p>
            <p class="last"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I 和 Q 样本仅具有 13 位分辨率，即使它们在无线电核心 RAM 中占用 16 位空间。由于它们仅具有 13 位分辨率，您将观察到的有符号整数的最大值和最小值是 [4095, -4096]。</font></font></p>
           </div>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RF Core 可以提供可映射到 DMA 的事件来触发 GPTimer 的启动。GPTimer 配置为 4us 倒计时模式，一旦达到 4us，它将生成另一个 DMA 事务来切换天线开关。</font></font></p>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在从属设备中，RF Core 补丁确保 CTE 插入到连接事件包的末尾，而不会被白化滤波器扭曲。</font></font></p>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在无源设备中，RF Core 补丁会分析数据包并在同步天线切换的同时开始在正确的时间捕获样本。样本留在 RF Core RAM 中，供主 MCU 分析</font></font></p>
          </div>
          <div class="section" id="aoa-driver"><span id="sec-aoa-driver"></span>
           <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AoA 驱动程序</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#aoa-driver" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AoA 驱动器负责天线切换和数据提取。</font></font></p>
           <div class="admonition note">
            <p class="first admonition-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">笔记</font></font></p>
            <p class="last"><font style="vertical-align: inherit;"></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#sec-aoa-integration"><span class="std std-ref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如集成</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中所述</font><font style="vertical-align: inherit;">，在此版本中，只有</font></font><code class="docutils literal notranslate"><span class="pre">rtls_passive</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设备可以捕获 I/Q 样本并触发无线电事件以供应用程序进行天线切换。</font></font></p>
           </div>
           <div class="section" id="data-collection-flow">
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据收集流程</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#data-collection-flow" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节中的大部分代码片段都包含在 AoA.c 中。无线电配置位于 中</font></font><code class="docutils literal notranslate"><span class="pre">urfi.c</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。当无线电核心在接收的数据包中检测到 AoA 音调信息时，它可以触发一个名为 的无线电事件</font></font><code class="docutils literal notranslate"><span class="pre">RFC_IN_EV4</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们可以将该事件路由到 DMA 通道 14 作为天线切换的启动触发器。</font></font></p>
            <blockquote>
             <div>
              <div class="literal-block-wrapper docutils container" id="id8">
               <div class="code-block-caption">
                <span class="caption-number"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 77.</font></font></span><span class="caption-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置无线电核心以</font></font><code class="docutils literal notranslate"><span class="pre">RAT_GPO4</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在接收 AoA 数据包时触发</font></font></span><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id8" title="此代码的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a>
               </div>
               <div class="highlight-c notranslate">
                <table class="highlighttable">
                 <tbody>
                  <tr>
                   <td class="linenos">
                    <div class="linenodiv">
                     <pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre>
                    </div></td>
                   <td class="code">
                    <div class="highlight">
                     <pre><span></span><span class="c1">// CMD_WRITE_FWPAR</span>
<span class="n">rfc_CMD_WRITE_FWPAR_t</span> <span class="n">RF_cmdWriteFwParRx</span> <span class="o">=</span>
<span class="p">{</span>
    <span class="p">.</span><span class="n">commandNo</span> <span class="o">=</span> <span class="n">CMD_WRITE_FWPAR</span><span class="p">,</span>
    <span class="p">.</span><span class="n">address</span> <span class="o">=</span> <span class="mi">188</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">),</span>
    <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="c1">// CMD_SET_RAT_CPT</span>
<span class="c1">// Set up RAT capture: RAT Channel 7, Rising edge, Single capture, and InputSrc 11</span>
<span class="n">rfc_CMD_SET_RAT_CPT_t</span> <span class="n">RF_cmdSetRatCpt</span> <span class="o">=</span>
<span class="p">{</span>
    <span class="p">.</span><span class="n">commandNo</span> <span class="o">=</span> <span class="n">CMD_SET_RAT_CPT</span><span class="p">,</span>
    <span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">inputSrc</span> <span class="o">=</span> <span class="mi">11</span><span class="p">,</span>
    <span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">ratCh</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
    <span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">bRepeated</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">inputMode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="c1">// CMD_SET_RAT_OUTPUT</span>
<span class="c1">// Setup IO configuration for RAT_GPO4, Pulse mode, RAT Channel 7</span>
<span class="n">rfc_CMD_SET_RAT_OUTPUT_t</span> <span class="n">RF_cmdSetRatOutput</span> <span class="o">=</span>
<span class="p">{</span>
    <span class="p">.</span><span class="n">commandNo</span> <span class="o">=</span> <span class="n">CMD_SET_RAT_OUTPUT</span><span class="p">,</span>
    <span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">outputSel</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
    <span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">outputMode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">ratCh</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
<span class="p">};</span>
</pre>
                    </div></td>
                  </tr>
                 </tbody>
                </table>
               </div>
              </div>
              <div class="literal-block-wrapper docutils container" id="id9">
               <div class="code-block-caption">
                <span class="caption-number"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 78.将事件</font></font></span><span class="caption-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">路由</font></font><code class="docutils literal notranslate"><span class="pre">RAT_GPO4</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到 DMACH14 </font></font></span><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id9" title="此代码的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a>
               </div>
               <div class="highlight-c notranslate">
                <table class="highlighttable">
                 <tbody>
                  <tr>
                   <td class="linenos">
                    <div class="linenodiv">
                     <pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre>
                    </div></td>
                   <td class="code">
                    <div class="highlight">
                     <pre><span></span><span class="c1">///// 1. RFC_IN_EV4 route to DMACH14                 ///////</span>
<span class="n">HWREG</span><span class="p">(</span><span class="n">EVENT_BASE</span> <span class="o">+</span> <span class="n">EVENT_O_UDMACH14BSEL</span><span class="p">)</span> <span class="o">=</span> <span class="n">EVENT_UDMACH14BSEL_EV_RFC_IN_EV4</span><span class="p">;</span>

<span class="c1">///// 2. Set up DMACH14, 1 to GPTn:CTL:TnEN register ///////</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">udmaHandle</span><span class="p">)</span> <span class="n">udmaHandle</span> <span class="o">=</span> <span class="n">UDMACC26XX_open</span><span class="p">();</span>

<span class="n">uDMAChannelControlSet</span><span class="p">(</span><span class="n">UDMA0_BASE</span><span class="p">,</span> <span class="n">UDMA_CHAN_DMA_PROG</span> <span class="o">|</span> <span class="n">UDMA_PRI_SELECT</span><span class="p">,</span> <span class="c1">//ch #14</span>
                      <span class="n">UDMA_SIZE_32</span> <span class="o">|</span> <span class="n">UDMA_SRC_INC_NONE</span> <span class="o">|</span>
                      <span class="n">UDMA_DST_INC_NONE</span> <span class="o">|</span>
                      <span class="n">UDMA_ARB_1</span><span class="p">);</span>
</pre>
                    </div></td>
                  </tr>
                 </tbody>
                </table>
               </div>
              </div>
              <div class="literal-block-wrapper docutils container" id="id10">
               <div class="code-block-caption">
                <span class="caption-number"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 79.</font></font></span><span class="caption-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 DMACH14 触发定时器 0A 启动</font></font></span><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id10" title="此代码的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a>
               </div>
               <div class="highlight-c notranslate">
                <table class="highlighttable">
                 <tbody>
                  <tr>
                   <td class="linenos">
                    <div class="linenodiv">
                     <pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre>
                    </div></td>
                   <td class="code">
                    <div class="highlight">
                     <pre><span></span><span class="kt">void</span> <span class="nf">AOA_configureHw</span><span class="p">(</span><span class="n">AoA_AntennaConfig</span> <span class="o">*</span><span class="n">config</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//...</span>
    <span class="k">static</span> <span class="k">volatile</span> <span class="kt">uint32_t</span> <span class="n">timerEnableWord</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">uDMAChannelTransferSet</span><span class="p">(</span><span class="n">UDMA0_BASE</span><span class="p">,</span> <span class="n">UDMA_CHAN_DMA_PROG</span> <span class="o">|</span> <span class="n">UDMA_PRI_SELECT</span><span class="p">,</span> <span class="c1">//ch #14</span>
                           <span class="n">UDMA_MODE_BASIC</span><span class="p">,</span> <span class="c1">//single transfer</span>
                           <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">timerEnableWord</span><span class="p">,</span><span class="c1">//source address</span>
                           <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)(</span><span class="n">GPT0_BASE</span> <span class="o">+</span> <span class="n">GPT_O_CTL</span><span class="p">),</span>
                           <span class="n">timerEnableWord</span><span class="p">);</span>
    <span class="n">uDMAChannelEnable</span><span class="p">(</span><span class="n">UDMA0_BASE</span><span class="p">,</span> <span class="n">UDMA_CHAN_DMA_PROG</span><span class="p">);</span>
    <span class="c1">//...</span>
<span class="p">}</span>
</pre>
                    </div></td>
                  </tr>
                 </tbody>
                </table>
               </div>
              </div>
             </div>
            </blockquote>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GPTimer 0A 配置为周期性下降，超时时间为 4us，超时（计时器匹配）事件被路由到 DMACH9 以触发天线切换。</font></font></p>
            <blockquote>
             <div>
              <div class="literal-block-wrapper docutils container" id="id11">
               <div class="code-block-caption">
                <span class="caption-number"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 80. </font></font></span><span class="caption-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GPTimer 0A 和 DMACH9 配置</font></font></span><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id11" title="此代码的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a>
               </div>
               <div class="highlight-c notranslate">
                <table class="highlighttable">
                 <tbody>
                  <tr>
                   <td class="linenos">
                    <div class="linenodiv">
                     <pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre>
                    </div></td>
                   <td class="code">
                    <div class="highlight">
                     <pre><span></span><span class="c1">///// 3. Enable DMA trigger on GPT compare match ///////</span>
<span class="n">HWREGBITW</span><span class="p">(</span><span class="n">GPT0_BASE</span> <span class="o">+</span> <span class="n">GPT_O_DMAEV</span><span class="p">,</span> <span class="n">GPT_DMAEV_TATODMAEN_BITN</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="c1">///// 4. Connect GPT0 DMA req to Channel 9 / DMA_CHAN_TIMER0_A ///////</span>
<span class="n">HWREG</span><span class="p">(</span><span class="n">EVENT_BASE</span> <span class="o">+</span> <span class="n">EVENT_O_UDMACH9SSEL</span><span class="p">)</span> <span class="o">=</span> <span class="n">EVENT_UDMACH9SSEL_EV_GPT0A_DMABREQ</span><span class="p">;</span>

<span class="c1">///// 5. Copy a toggle entry into GPIOTGL on timer match ///////</span>
<span class="n">uDMAChannelControlSet</span><span class="p">(</span><span class="n">UDMA0_BASE</span><span class="p">,</span> <span class="n">UDMA_CHAN_TIMER0_A</span> <span class="o">|</span> <span class="n">UDMA_PRI_SELECT</span><span class="p">,</span> <span class="c1">//ch #9</span>
                      <span class="n">UDMA_SIZE_32</span> <span class="o">|</span> <span class="n">UDMA_SRC_INC_32</span> <span class="o">|</span>
                      <span class="n">UDMA_DST_INC_NONE</span> <span class="o">|</span>
                      <span class="n">UDMA_ARB_1</span><span class="p">);</span>
</pre>
                    </div></td>
                  </tr>
                 </tbody>
                </table>
               </div>
              </div>
             </div>
            </blockquote>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当接收到 AoA 数据包（AOA.c）时，DMA 将传输模式来切换 BOOSTXL-AoA 板上的天线。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RF核心在音调出现3.25us时触发一个事件。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，为了实现 4us 保护时间，</font></font><code class="docutils literal notranslate"><span class="pre">AOA_SIGNAL_DELAY_TIME</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须将其设置为 0.75us，相当于滴答数 0.75*48 = 36。无线电核心不会在保护时间内收集 I/Q 样本。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的数字</font></font><code class="docutils literal notranslate"><span class="pre">AOA_SIGNAL_DELAY_TIME</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是在实验室测量中发现的，不建议更改它。查找方法将在</font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#sec-gptimer-delay-tuning"><span class="std std-ref"><font style="vertical-align: inherit;">GPTimer 延迟调整</font></span></a></font><code class="docutils literal notranslate"><span class="pre">AOA_SIGNAL_DELAY_TIME</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中说明</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#sec-gptimer-delay-tuning"><span class="std std-ref"><font style="vertical-align: inherit;"></font></span></a></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户可以通过更改来决定在保护时间结束后等待天线开始切换的时间</font></font><code class="docutils literal notranslate"><span class="pre">AOA_ANT_SWITCH_START_TIME</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。在我们的示例应用程序中，我们将其设置为 8us（</font></font><code class="docutils literal notranslate"><span class="pre">AOA_ANT_SWITCH_START_TIME</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 8*48 = 384）。</font></font></p>
            <blockquote>
             <div>
              <div class="literal-block-wrapper docutils container" id="id12">
               <div class="code-block-caption">
                <span class="caption-number"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 81.</font></font></span><span class="caption-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将 DMACH9 路由到 GPIO 切换寄存器并设置初始定时器延迟</font></font></span><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id12" title="此代码的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a>
               </div>
               <div class="highlight-c notranslate">
                <table class="highlighttable">
                 <tbody>
                  <tr>
                   <td class="linenos">
                    <div class="linenodiv">
                     <pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre>
                    </div></td>
                   <td class="code">
                    <div class="highlight">
                     <pre><span></span><span class="kt">uint32_t</span> <span class="n">AOA_ANT_SWITCH_START_TIME</span> <span class="o">=</span> <span class="mi">384</span><span class="p">;</span>
<span class="kt">uint32_t</span> <span class="n">AOA_SIGNAL_DELAY_TIME</span> <span class="o">=</span> <span class="mi">36</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">AOA_configureHw</span><span class="p">(</span><span class="n">AoA_AntennaConfig</span> <span class="o">*</span><span class="n">config</span><span class="p">)</span>
<span class="p">{</span>

    <span class="c1">// ...</span>
    <span class="n">uDMAChannelTransferSet</span><span class="p">(</span><span class="n">UDMA0_BASE</span><span class="p">,</span> <span class="n">UDMA_CHAN_TIMER0_A</span> <span class="o">|</span> <span class="n">UDMA_PRI_SELECT</span><span class="p">,</span> <span class="c1">//ch #9</span>
                           <span class="n">UDMA_MODE_BASIC</span><span class="p">,</span> <span class="c1">//single transfer</span>
                           <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">pattern</span><span class="o">-&gt;</span><span class="n">toggles</span><span class="p">,</span><span class="c1">//source address</span>
                           <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)(</span><span class="n">GPIO_BASE</span> <span class="o">+</span> <span class="n">GPIO_O_DOUTTGL31_0</span><span class="p">),</span> <span class="c1">//destination address</span>
                           <span class="n">pattern</span><span class="o">-&gt;</span><span class="n">numPatterns</span><span class="p">);</span>
    <span class="n">uDMAChannelEnable</span><span class="p">(</span><span class="n">UDMA0_BASE</span><span class="p">,</span> <span class="n">UDMA_CHAN_TIMER0_A</span><span class="p">);</span>

    <span class="c1">// Re-enable timer start</span>
    <span class="k">static</span> <span class="k">volatile</span> <span class="kt">uint32_t</span> <span class="n">timerEnableWord</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">uDMAChannelTransferSet</span><span class="p">(</span><span class="n">UDMA0_BASE</span><span class="p">,</span> <span class="n">UDMA_CHAN_DMA_PROG</span> <span class="o">|</span> <span class="n">UDMA_PRI_SELECT</span><span class="p">,</span> <span class="c1">//ch #14</span>
                           <span class="n">UDMA_MODE_BASIC</span><span class="p">,</span> <span class="c1">//single transfer</span>
                           <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">timerEnableWord</span><span class="p">,</span><span class="c1">//source address</span>
                           <span class="c1">//(void *)&amp;HWREGBITW(GPT0_BASE + GPT_O_CTL, GPT_CTL_TAEN_BITN), //destination address</span>
                           <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)(</span><span class="n">GPT0_BASE</span> <span class="o">+</span> <span class="n">GPT_O_CTL</span><span class="p">),</span>
                           <span class="mi">1</span><span class="p">);</span>
    <span class="n">uDMAChannelEnable</span><span class="p">(</span><span class="n">UDMA0_BASE</span><span class="p">,</span> <span class="n">UDMA_CHAN_DMA_PROG</span><span class="p">);</span>


    <span class="c1">// First period is 4us guard time + 8us reference = 12us</span>
    <span class="n">HWREG</span><span class="p">(</span><span class="n">GPT0_BASE</span> <span class="o">+</span> <span class="n">GPT_O_TAV</span><span class="p">)</span> <span class="o">=</span> <span class="n">AOA_SIGNAL_DELAY_TIME</span> <span class="o">+</span> <span class="n">AOA_ANT_SWITCH_START_TIME</span><span class="p">;</span>
<span class="p">}</span>
</pre>
                    </div></td>
                  </tr>
                 </tbody>
                </table>
               </div>
              </div>
             </div>
            </blockquote>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">天线切换后，您可以通过以下函数获取指向无线电 RAM 中的 IQ 样本的指针。</font></font></p>
            <blockquote>
             <div>
              <div class="literal-block-wrapper docutils container" id="id13">
               <div class="code-block-caption">
                <span class="caption-number"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 82.</font></font></span><span class="caption-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从无线电 RAM 中提取 I/Q 样本</font></font></span><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id13" title="此代码的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a>
               </div>
               <div class="highlight-c notranslate">
                <table class="highlighttable">
                 <tbody>
                  <tr>
                   <td class="linenos">
                    <div class="linenodiv">
                     <pre>1</pre>
                    </div></td>
                   <td class="code">
                    <div class="highlight">
                     <pre><span></span><span class="kt">void</span> <span class="n">AOA_getRxIQ</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="o">*</span><span class="n">packetId</span><span class="p">,</span> <span class="n">AoA_IQSample</span> <span class="o">**</span><span class="n">samples</span><span class="p">)</span>
</pre>
                    </div></td>
                  </tr>
                 </tbody>
                </table>
               </div>
              </div>
             </div>
            </blockquote>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后数据被传递进去</font></font><code class="docutils literal notranslate"><span class="pre">AOA_getPairAngles()</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以获得接收器和发送器之间的估计角度。</font></font></p>
            <blockquote>
             <div>
              <div class="literal-block-wrapper docutils container" id="id14">
               <div class="code-block-caption">
                <span class="caption-number"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 83.</font></font></span><span class="caption-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">角度估计</font></font></span><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id14" title="此代码的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a>
               </div>
               <div class="highlight-c notranslate">
                <table class="highlighttable">
                 <tbody>
                  <tr>
                   <td class="linenos">
                    <div class="linenodiv">
                     <pre>1</pre>
                    </div></td>
                   <td class="code">
                    <div class="highlight">
                     <pre><span></span><span class="kt">void</span> <span class="n">AOA_getPairAngles</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</pre>
                    </div></td>
                  </tr>
                 </tbody>
                </table>
               </div>
              </div>
             </div>
            </blockquote>
           </div>
           <div class="section" id="gptimer-delay-tuning"><span id="sec-gptimer-delay-tuning"></span>
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GPTimer 延迟调整</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#gptimer-delay-tuning" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了找到无线电核心检测到 AoA 数据包和 GPTimer 启动之间的信号延迟，我们首先在设置</font></font><code class="docutils literal notranslate"><span class="pre">AOA_SIGNAL_DELAY_TIME</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 0 和</font></font><code class="docutils literal notranslate"><span class="pre">AOA_ANT_SWITCH_START_TIME</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 0 时提取 I/Q 数据。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们观察到 I/Q 样本在采样时间中稳定下来约 0.25us。当音调开始时，RF 核心立即触发事件。首先，从</font></font><code class="docutils literal notranslate"><span class="pre">RFC_IN_EV4</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GPIO 切换需要约 1 us（对于</font></font><code class="docutils literal notranslate"><span class="pre">RFC_IN_EV4</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-&gt; DMA9 为 600 ns，对于 DMA9 -&gt; GPIO 为 400 ns）。然后从天线切换需要约 2.25 us，直到我们可以在 IQ 数据中看到这一点（通过 RF/IF 链、IF ADC、IQ 重新采样器和 RAM 写入的延迟）。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们已经知道我们的天线稳定时间是 1 微秒，所以如果我们希望天线切换从 IQ 样本 [0] 开始，</font></font><code class="docutils literal notranslate"><span class="pre">AOA_SIGNAL_DELAY_TIME</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则需要 0.75 微秒（0.75*48）。</font></font></p><img alt="../_images/ditaa-00cf7423c9daf11833a0b964eac36776a559557c.png" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/ditaa-00cf7423c9daf11833a0b964eac36776a559557c.png">
           </div>
           <div class="section" id="antenna-switching">
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">天线切换</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#antenna-switching" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制模式位于 ant_array1_config_boostxl_rev1v1.c 和 ant_array2_config_boostxl_rev1v1.c 中：我们将重点关注天线阵列 1 的代码。同样的理论也适用于天线阵列 2。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这</font></font><code class="docutils literal notranslate"><span class="pre">AOA_PIN()</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只是一个按位运算。如果您想使用自己的设计（不同的 IO），则需要更改传递给</font></font><code class="docutils literal notranslate"><span class="pre">AOA_PIN</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数的参数。</font></font></p>
            <blockquote>
             <div>
              <div class="literal-block-wrapper docutils container" id="id15">
               <div class="code-block-caption">
                <span class="caption-number"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 84.</font></font></span><span class="caption-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 ant_array1_config_boostxl_rev1v1.c 中选择用于天线控制的 IO </font></font></span><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id15" title="此代码的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a>
               </div>
               <div class="highlight-c notranslate">
                <table class="highlighttable">
                 <tbody>
                  <tr>
                   <td class="linenos">
                    <div class="linenodiv">
                     <pre>1
2
3
4
5
6
7</pre>
                    </div></td>
                   <td class="code">
                    <div class="highlight">
                     <pre><span></span><span class="c1">// User defined nice-names for the pins</span>
<span class="cp">#define AOA_A1_SEL     AOA_PIN(IOID_27)</span>
<span class="cp">#define AOA_Ax_ANT1    AOA_PIN(IOID_28)</span>
<span class="cp">#define AOA_Ax_ANT2    AOA_PIN(IOID_29)</span>
<span class="cp">#define AOA_Ax_ANT3    AOA_PIN(IOID_30)</span>

<span class="cp">#define AOA_PIN(x) (1 &lt;&lt; (x&amp;0xff))</span>
</pre>
                    </div></td>
                  </tr>
                 </tbody>
                </table>
               </div>
              </div>
             </div>
            </blockquote>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了对天线文件所做的更改之外，您还需要修改 AOA.c 中使用的代码的突出显示部分。</font></font></p>
            <blockquote>
             <div>
              <div class="literal-block-wrapper docutils container" id="id16">
               <div class="code-block-caption">
                <span class="caption-number"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 85. </font></font></span><span class="caption-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AOA.c 中的 IO 掩码</font></font></span><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id16" title="此代码的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a>
               </div>
               <div class="highlight-c notranslate">
                <table class="highlighttable">
                 <tbody>
                  <tr>
                   <td class="linenos">
                    <div class="linenodiv">
                     <pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre>
                    </div></td>
                   <td class="code">
                    <div class="highlight">
                     <pre><span></span><span class="kt">bool</span> <span class="nf">AOA_openPins</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">PIN_Handle</span> <span class="n">pinHandle</span><span class="p">;</span>
    <span class="kt">uint32_t</span> <span class="n">pinCfg</span><span class="p">;</span>
    <span class="n">PIN_State</span> <span class="n">pinState</span><span class="p">;</span>

<span class="hll">    <span class="n">pinMask</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">IOID_27</span> <span class="o">|</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">IOID_28</span> <span class="o">|</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">IOID_29</span> <span class="o">|</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">IOID_30</span><span class="p">);</span>
</span>    <span class="n">pinCfg</span> <span class="o">=</span> <span class="n">PIN_TERMINATE</span><span class="p">;</span>
    <span class="n">pinHandle</span> <span class="o">=</span> <span class="n">PIN_open</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pinState</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pinCfg</span><span class="p">);</span>

    <span class="c1">//....</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">pinMask</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">PIN_close</span><span class="p">(</span><span class="n">pinHandle</span><span class="p">);</span> <span class="c1">// If remaining pins, we failed to open all.</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

<span class="hll">    <span class="n">pinMask</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">IOID_27</span> <span class="o">|</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">IOID_28</span> <span class="o">|</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">IOID_29</span> <span class="o">|</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">IOID_30</span><span class="p">);</span>
</span>    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</pre>
                    </div></td>
                  </tr>
                 </tbody>
                </table>
               </div>
              </div>
             </div>
            </blockquote>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始模式表明，在我们的示例中，天线阵列组 1 下的第二根天线用于接收开始和结束时的传入数据包。</font></font></p>
            <blockquote>
             <div>
              <div class="literal-block-wrapper docutils container" id="id17">
               <div class="code-block-caption">
                <span class="caption-number"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 86.</font></font></span><span class="caption-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">天线模式设置</font></font></span><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id17" title="此代码的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a>
               </div>
               <div class="highlight-c notranslate">
                <table class="highlighttable">
                 <tbody>
                  <tr>
                   <td class="linenos">
                    <div class="linenodiv">
                     <pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre>
                    </div></td>
                   <td class="code">
                    <div class="highlight">
                     <pre><span></span><span class="n">AoA_Pattern</span> <span class="n">antennaPattern_A1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">.</span><span class="n">numPatterns</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
    <span class="p">.</span><span class="n">initialPattern</span> <span class="o">=</span> <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT2</span><span class="p">,</span>
    <span class="p">.</span><span class="n">toggles</span> <span class="o">=</span>
    <span class="p">{</span>
     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT1</span><span class="p">,</span> <span class="c1">// A1.1</span>
     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT2</span><span class="p">,</span> <span class="c1">// A1.2</span>
     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT3</span><span class="p">,</span> <span class="c1">// A1.3</span>

     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT1</span><span class="p">,</span> <span class="c1">// A1.1</span>
     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT2</span><span class="p">,</span> <span class="c1">// A1.2</span>
     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT3</span><span class="p">,</span> <span class="c1">// A1.3</span>

     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT1</span><span class="p">,</span> <span class="c1">// A1.1</span>
     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT2</span><span class="p">,</span> <span class="c1">// A1.2</span>
     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT3</span><span class="p">,</span> <span class="c1">// A1.3</span>

     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT1</span><span class="p">,</span> <span class="c1">// A1.1</span>
     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT2</span><span class="p">,</span> <span class="c1">// A1.2</span>
     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT3</span><span class="p">,</span> <span class="c1">// A1.3</span>

     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT1</span><span class="p">,</span> <span class="c1">// A1.1</span>
     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT2</span><span class="p">,</span> <span class="c1">// A1.2</span>
     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT3</span><span class="p">,</span> <span class="c1">// A1.3</span>

     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT1</span><span class="p">,</span> <span class="c1">// A1.1</span>
     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT2</span><span class="p">,</span> <span class="c1">// A1.2</span>
     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT3</span><span class="p">,</span> <span class="c1">// A1.3</span>

     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT1</span><span class="p">,</span> <span class="c1">// A1.1</span>
     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT2</span><span class="p">,</span> <span class="c1">// A1.2</span>
     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT3</span><span class="p">,</span> <span class="c1">// A1.3</span>

     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT1</span><span class="p">,</span> <span class="c1">// A1.1</span>
     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT2</span><span class="p">,</span> <span class="c1">// A1.2</span>
     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT3</span><span class="p">,</span> <span class="c1">// A1.3</span>

     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT1</span><span class="p">,</span> <span class="c1">// A1.1</span>
     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT2</span><span class="p">,</span> <span class="c1">// A1.2</span>
     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT3</span><span class="p">,</span> <span class="c1">// A1.3</span>

     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT1</span><span class="p">,</span> <span class="c1">// A1.1</span>
     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT2</span><span class="p">,</span> <span class="c1">// A1.2</span>
     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT3</span><span class="p">,</span> <span class="c1">// A1.3</span>

     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT2</span><span class="p">,</span> <span class="c1">// A1.2</span>
     <span class="n">AOA_A1_SEL</span> <span class="o">|</span> <span class="n">AOA_Ax_ANT2</span><span class="p">,</span> <span class="c1">// A1.2</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre>
                    </div></td>
                  </tr>
                 </tbody>
                </table>
               </div>
              </div>
             </div>
            </blockquote>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之后，一旦检测到 AoA 数据包，我们将开始切换 IO 以选择不同的天线，以便收集每个天线之间的相位差。这里我们使用</font></font><code class="docutils literal notranslate"><span class="pre">GPIO:DOUTTGL31_0</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">寄存器来启用切换功能。有关更多信息，请参阅</font></font><a class="reference external" href="https://translate.google.com/website?sl=auto&amp;tl=zh-CN&amp;hl=en&amp;client=webapp&amp;u=http://dev.ti.com/tirex/%23/?link%3DSoftware%252FSimpleLink%2520CC2640R2%2520SDK%252FDocuments%252FDriverLib%252FDriverlib%2520Documentation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Driverlib 文档</font></font></a> <a class="reference external" href="https://translate.google.com/website?sl=auto&amp;tl=zh-CN&amp;hl=en&amp;client=webapp&amp;u=https://www.ti.com/product/CC2640R2F"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CC2640R2F</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -&gt; CPU 域寄存器说明 -&gt;</font></font><code class="docutils literal notranslate"><span class="pre">GPIO:DOUTTGL31_0</span></code></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用的第一根天线是受 控制的第二根天线</font></font><code class="docutils literal notranslate"><span class="pre">IOID_29</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后我们想要切换到不同的天线（假设天线 1 </font></font><code class="docutils literal notranslate"><span class="pre">IOID_28</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。这意味着我们需要切换</font></font><code class="docutils literal notranslate"><span class="pre">IOID_29</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="docutils literal notranslate"><span class="pre">IOID_28</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。然后我们需要将寄存器中的位 [29] 和位 [28] 都设置为 1</font></font><code class="docutils literal notranslate"><span class="pre">GPIO:DOUTTGL31_0</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">才能切换。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的软件解决方案中，以下函数负责切换模式生成。它获取上一个选定项</font></font><code class="docutils literal notranslate"><span class="pre">IOID_x</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并与当前选定项进行异或</font></font><code class="docutils literal notranslate"><span class="pre">IOID_x</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
            <blockquote>
             <div>
              <div class="literal-block-wrapper docutils container" id="id18">
               <div class="code-block-caption">
                <span class="caption-number"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 87.</font></font></span><span class="caption-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成 IO 切换模式的函数</font></font></span><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id18" title="此代码的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a>
               </div>
               <div class="highlight-c notranslate">
                <table class="highlighttable">
                 <tbody>
                  <tr>
                   <td class="linenos">
                    <div class="linenodiv">
                     <pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre>
                    </div></td>
                   <td class="code">
                    <div class="highlight">
                     <pre><span></span><span class="kt">void</span> <span class="nf">AOA_toggleMaker</span><span class="p">(</span><span class="k">const</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">in</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">initState</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">len</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">out</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">uint32_t</span> <span class="n">currState</span> <span class="o">=</span> <span class="n">initState</span><span class="p">;</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">len</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">uint32_t</span> <span class="n">tgl</span> <span class="o">=</span> <span class="n">currState</span> <span class="o">^</span> <span class="n">in</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">currState</span> <span class="o">^=</span> <span class="n">tgl</span><span class="p">;</span>
        <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tgl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
                    </div></td>
                  </tr>
                 </tbody>
                </table>
               </div>
              </div>
             </div>
            </blockquote>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，您只需设计模式，然后调用以下两个函数来初始化模式（假设您有两个数组）。这两个函数在 AOA.c 中调用</font><font style="vertical-align: inherit;">。</font></font><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">AOA_init(AoA_Results_t</span> <span class="pre">*aoaResults)</span></code><font style="vertical-align: inherit;"></font></p>
            <blockquote>
             <div>
              <div class="literal-block-wrapper docutils container" id="id19">
               <div class="code-block-caption">
                <span class="caption-number"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 88.</font></font></span><span class="caption-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成 IO 切换模式的函数</font></font></span><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id19" title="此代码的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a>
               </div>
               <div class="highlight-c notranslate">
                <table class="highlighttable">
                 <tbody>
                  <tr>
                   <td class="linenos">
                    <div class="linenodiv">
                     <pre>1
2</pre>
                    </div></td>
                   <td class="code">
                    <div class="highlight">
                     <pre><span></span><span class="n">BOOSTXL_AoA_AntennaPattern_A1_init</span><span class="p">();</span>
<span class="n">BOOSTXL_AoA_AntennaPattern_A2_init</span><span class="p">();</span>
</pre>
                    </div></td>
                  </tr>
                 </tbody>
                </table>
               </div>
              </div>
             </div>
            </blockquote>
           </div>
           <div class="section" id="convert-i-q-data-to-angle-difference">
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将 I/Q 数据转换为角度差</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#convert-i-q-data-to-angle-difference" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当射频波入射到天线阵列上（假设板上只有 2 个天线）并在不同时间到达不同天线时，天线之间会存在相位差。因此我们提取 ant1_sample[8 to 15] 和 ant2_sample[8 to 15] 之间的相位差。天线之间的切换会导致测量误差，因此我们在计算角度时丢弃 0 到 7 之间的 I/Q 样本。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当使用与 BOOSTXL-AoA 板上的天线开关不同的自定义硬件时，如果天线开关稳定时间短于 1 微秒，您可能能够使用更多 I/Q 样本。确定可使用多少个 I/Q 样本的方法在</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#sec-valid-iq-samples"><span class="std std-ref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">角度计算的有效 I/Q 样本中进行了说明</font></font></span></a></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I/Q 数据可以呈现为具有实数 I 和虚数 Q（90 度差）的 XY 域。如前所述，对于每个 250 kHz 信号周期，我们采样 16 个 I 和 Q 数据。如果没有差异，则意味着 I/Q 数据相同，因此 ant_1 样本 1 与 ant_2 样本 1 之间的相位将相同。</font></font></p>
            <blockquote>
             <div>
              <div class="figure align-center"><img alt="../_images/ant1_ant2_samplen.png" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/ant1_ant2_samplen.png">
              </div>
              <div class="figure align-center"><img alt="../_images/anlge_of_interest.png" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/anlge_of_interest.png">
              </div>
             </div>
            </blockquote>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是将 I/Q 数据放入二维的代码，然后我们将 I/Q 对传递到函数中</font></font><code class="docutils literal notranslate"><span class="pre">AOA_AngleComplexProductComp()</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以获得最终角度。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">样本阵列有 32 个偏移的原因在于我们使用 8us 作为保护时间（由 控制</font></font><code class="docutils literal notranslate"><span class="pre">AOA_ANT_SWITCH_START_TIME</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。8 us 保护时间和 4 MHz 采样率为我们提供 32 个样本，因此我们在保护时间之后获取 I/Q 样本。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于想要有不同保护时间的用户，偏移量应计算为“保护时间（以 us 为单位）x 采样率（以 MHz 为单位）”。</font></font></p>
            <blockquote>
             <div>
              <div class="literal-block-wrapper docutils container" id="id20">
               <div class="code-block-caption">
                <span class="caption-number"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 89.</font></font></span><span class="caption-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取 co 计算</font></font></span><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id20" title="此代码的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。¶</font></font></a>
               </div>
               <div class="highlight-c notranslate">
                <table class="highlighttable">
                 <tbody>
                  <tr>
                   <td class="linenos">
                    <div class="linenodiv">
                     <pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre>
                    </div></td>
                   <td class="code">
                    <div class="highlight">
                     <pre><span></span><span class="k">for</span> <span class="p">(</span><span class="kt">uint16_t</span> <span class="n">i</span> <span class="o">=</span> <span class="n">AOA_OFFSET_FIRST_VALID_SAMPLE</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">AOA_NUM_VALID_SAMPLES</span> <span class="o">+</span> <span class="n">AOA_OFFSET_FIRST_VALID_SAMPLE</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Loop through antenna pairs and calculate phase difference</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">uint8_t</span> <span class="n">pair</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">pair</span> <span class="o">&lt;</span> <span class="n">numPairs</span><span class="p">;</span> <span class="o">++</span><span class="n">pair</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">const</span> <span class="n">AoA_AntennaPair</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">gAoaReport</span><span class="p">.</span><span class="n">antConfig</span><span class="o">-&gt;</span><span class="n">pairs</span><span class="p">[</span><span class="n">pair</span><span class="p">];</span>
    <span class="kt">uint8_t</span> <span class="n">a</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">a</span><span class="p">;</span> <span class="c1">// First antenna in pair</span>
    <span class="kt">uint8_t</span> <span class="n">b</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">;</span> <span class="c1">// Second antenna in pair</span>

    <span class="c1">// ...</span>
    <span class="c1">// ...</span>

    <span class="c1">// Calculate phase difference between antenna a vs. antenna b</span>
<span class="hll">    <span class="kt">int16_t</span> <span class="n">Pab_rel</span> <span class="o">=</span> <span class="n">AOA_AngleComplexProductComp</span><span class="p">(</span><span class="n">gAoaReport</span><span class="p">.</span><span class="n">samples</span><span class="p">[</span><span class="mi">32</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="n">numAnt</span><span class="o">*</span><span class="n">gAoaNumSamplesPerBlock</span> <span class="o">+</span> <span class="n">a</span><span class="o">*</span><span class="n">gAoaNumSamplesPerBlock</span> <span class="o">+</span> <span class="n">i</span><span class="p">].</span><span class="n">i</span><span class="p">,</span>
</span><span class="hll">                                                  <span class="n">gAoaReport</span><span class="p">.</span><span class="n">samples</span><span class="p">[</span><span class="mi">32</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="n">numAnt</span><span class="o">*</span><span class="n">gAoaNumSamplesPerBlock</span> <span class="o">+</span> <span class="n">a</span><span class="o">*</span><span class="n">gAoaNumSamplesPerBlock</span> <span class="o">+</span> <span class="n">i</span><span class="p">].</span><span class="n">q</span><span class="p">,</span>
</span><span class="hll">                                                  <span class="n">gAoaReport</span><span class="p">.</span><span class="n">samples</span><span class="p">[</span><span class="mi">32</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="n">numAnt</span><span class="o">*</span><span class="n">gAoaNumSamplesPerBlock</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">gAoaNumSamplesPerBlock</span> <span class="o">+</span> <span class="n">i</span><span class="p">].</span><span class="n">i</span><span class="p">,</span>
</span><span class="hll">                                                  <span class="n">gAoaReport</span><span class="p">.</span><span class="n">samples</span><span class="p">[</span><span class="mi">32</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="n">numAnt</span><span class="o">*</span><span class="n">gAoaNumSamplesPerBlock</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">gAoaNumSamplesPerBlock</span> <span class="o">+</span> <span class="n">i</span><span class="p">].</span><span class="n">q</span><span class="p">);</span>
</span>
    <span class="c1">// Add to averages</span>
    <span class="c1">// v-- Correct for angle drift / ADC sampling frequency error</span>
    <span class="n">antenna_versus_avg</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Pab_rel</span> <span class="o">+</span> <span class="p">((</span><span class="n">Paa_rel</span> <span class="o">*</span> <span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">))</span> <span class="o">/</span> <span class="n">numAnt</span><span class="p">);</span>
    <span class="n">antenna_versus_cnt</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int32_t</span> <span class="n">AOA_AngleComplexProductComp</span><span class="p">(</span><span class="kt">int32_t</span> <span class="n">Xre</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="n">Xim</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="n">Yre</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="n">Yim</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int32_t</span> <span class="n">Zre</span><span class="p">,</span> <span class="n">Zim</span><span class="p">;</span>
  <span class="kt">int16_t</span> <span class="n">angle</span><span class="p">;</span>

  <span class="c1">// X*conj(Y)</span>
  <span class="n">Zre</span> <span class="o">=</span> <span class="n">Xre</span><span class="o">*</span><span class="n">Yre</span> <span class="o">+</span> <span class="n">Xim</span><span class="o">*</span><span class="n">Yim</span><span class="p">;</span>
  <span class="n">Zim</span> <span class="o">=</span> <span class="n">Xim</span><span class="o">*</span><span class="n">Yre</span> <span class="o">-</span> <span class="n">Xre</span><span class="o">*</span><span class="n">Yim</span><span class="p">;</span>

  <span class="c1">// Angle. The angle is returned in 256/2*pi format [-128,127] values</span>
  <span class="n">angle</span> <span class="o">=</span> <span class="n">AOA_iatan2sc</span><span class="p">((</span><span class="kt">int32_t</span><span class="p">)</span> <span class="n">Zim</span><span class="p">,</span> <span class="p">(</span><span class="kt">int32_t</span><span class="p">)</span> <span class="n">Zre</span><span class="p">);</span>

  <span class="k">return</span> <span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">angleconst</span><span class="p">);</span>
<span class="p">}</span>
</pre>
                    </div></td>
                  </tr>
                 </tbody>
                </table>
               </div>
              </div>
             </div>
            </blockquote>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要强调的是，实际上 250kHz 可能并不完美（例如，可能是 255kHz 或 245kHZ），因此，ant_1 sample_n 和 ant_1 sample_(n + 16*1) 之间存在轻微的相位差。因此还应用了运行时补偿：</font></font></p>
            <blockquote>
             <div>
              <div class="literal-block-wrapper docutils container" id="id21">
               <div class="code-block-caption">
                <span class="caption-number"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 90.</font></font></span><span class="caption-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">补偿方法</font></font></span><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id21" title="此代码的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。¶</font></font></a>
               </div>
               <div class="highlight-c notranslate">
                <table class="highlighttable">
                 <tbody>
                  <tr>
                   <td class="linenos">
                    <div class="linenodiv">
                     <pre>1
2
3
4
5</pre>
                    </div></td>
                   <td class="code">
                    <div class="highlight">
                     <pre><span></span><span class="c1">// Calculate the phase drift across one antenna repetition (X * complex conjugate (Y))</span>
<span class="kt">int16_t</span> <span class="n">Paa_rel</span> <span class="o">=</span> <span class="n">AOA_AngleComplexProductComp</span><span class="p">(</span><span class="n">gAoaReport</span><span class="p">.</span><span class="n">samples</span><span class="p">[</span><span class="mi">32</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="n">numAnt</span><span class="o">*</span><span class="n">gAoaNumSamplesPerBlock</span>     <span class="o">+</span> <span class="n">a</span><span class="o">*</span><span class="n">gAoaNumSamplesPerBlock</span> <span class="o">+</span> <span class="n">i</span><span class="p">].</span><span class="n">i</span><span class="p">,</span>
                                              <span class="n">gAoaReport</span><span class="p">.</span><span class="n">samples</span><span class="p">[</span><span class="mi">32</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="n">numAnt</span><span class="o">*</span><span class="n">gAoaNumSamplesPerBlock</span>     <span class="o">+</span> <span class="n">a</span><span class="o">*</span><span class="n">gAoaNumSamplesPerBlock</span> <span class="o">+</span> <span class="n">i</span><span class="p">].</span><span class="n">q</span><span class="p">,</span>
                                              <span class="n">gAoaReport</span><span class="p">.</span><span class="n">samples</span><span class="p">[</span><span class="mi">32</span> <span class="o">+</span> <span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">numAnt</span><span class="o">*</span><span class="n">gAoaNumSamplesPerBlock</span> <span class="o">+</span> <span class="n">a</span><span class="o">*</span><span class="n">gAoaNumSamplesPerBlock</span> <span class="o">+</span> <span class="n">i</span><span class="p">].</span><span class="n">i</span><span class="p">,</span>
                                              <span class="n">gAoaReport</span><span class="p">.</span><span class="n">samples</span><span class="p">[</span><span class="mi">32</span> <span class="o">+</span> <span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">numAnt</span><span class="o">*</span><span class="n">gAoaNumSamplesPerBlock</span> <span class="o">+</span> <span class="n">a</span><span class="o">*</span><span class="n">gAoaNumSamplesPerBlock</span> <span class="o">+</span> <span class="n">i</span><span class="p">].</span><span class="n">q</span><span class="p">);</span>
</pre>
                    </div></td>
                  </tr>
                 </tbody>
                </table>
               </div>
              </div>
             </div>
            </blockquote>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于 250kHz 音调不完美，相位差会累积。假设每个周期会有 45 度的延迟。那么当比较 ant_1 sample_n 和 ant_1 sample_(n+16*1) 时，累积相位差为 90 度。但每个周期之间的实际相位差只有 45。因此，计算出的相位差必须除以所用天线的数量，在我们的例子中是 2。</font></font></p>
            <blockquote>
             <div>
              <div class="literal-block-wrapper docutils container" id="id22">
               <div class="code-block-caption">
                <span class="caption-number"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 91.</font></font></span><span class="caption-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最终角度</font></font></span><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id22" title="此代码的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a>
               </div>
               <div class="highlight-c notranslate">
                <table class="highlighttable">
                 <tbody>
                  <tr>
                   <td class="linenos">
                    <div class="linenodiv">
                     <pre>1</pre>
                    </div></td>
                   <td class="code">
                    <div class="highlight">
                     <pre><span></span><span class="n">antenna_versus_avg</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">phaseDiff</span> <span class="o">+</span> <span class="p">((</span><span class="n">phaseError</span> <span class="o">*</span> <span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">))</span> <span class="o">/</span> <span class="n">numAnt</span><span class="p">);</span>
</pre>
                    </div></td>
                  </tr>
                 </tbody>
                </table>
               </div>
              </div>
             </div>
            </blockquote>
           </div>
           <div class="section" id="valid-i-q-samples-for-angle-calculation"><span id="sec-valid-iq-samples"></span>
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于角度计算的有效 I/Q 样本</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#valid-i-q-samples-for-angle-calculation" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了确定要使用哪些 I/Q 样本，最简单的方法是绘制所有 I/Q 样本。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下图显示了使用示例以及和示例</font></font><code class="docutils literal notranslate"><span class="pre">rtls_passive</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一起</font><font style="vertical-align: inherit;">收集的 I/Q 样本</font><font style="vertical-align: inherit;">。</font></font><code class="docutils literal notranslate"><span class="pre">rtls_master</span></code><font style="vertical-align: inherit;"></font><code class="docutils literal notranslate"><span class="pre">rtls_slave</span></code><font style="vertical-align: inherit;"></font></p>
            <blockquote>
             <div>
              <div class="wy-table-responsive"><table border="1" class="docutils" id="id23">
               <caption>
                <span class="caption-number"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表 21.</font></font></span><span class="caption-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">轴描述</font></font></span><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id23" title="此表的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a>
               </caption>
               <colgroup>
                <col width="15%">
                <col width="85%">
               </colgroup>
               <thead valign="bottom">
                <tr class="row-odd">
                 <th class="head"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">轴</font></font></th>
                 <th class="head"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
                </tr>
               </thead>
               <tbody valign="top">
                <tr class="row-even">
                 <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">X顶部</font></font></td>
                 <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rtls_slave 设备和 rtls_passive 之间的角度。</font></font></td>
                </tr>
                <tr class="row-odd">
                 <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">X底部</font></font></td>
                 <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I/Q 数据的索引号。</font></font></td>
                </tr>
                <tr class="row-even">
                 <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
                 <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I/Q 值。</font></font></td>
                </tr>
               </tbody>
              </table></div>
             </div>
            </blockquote>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前 32 个（索引 0~31）样本是在没有天线切换的参考周期内采集的。因此 I/Q 图看起来像正弦波。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之后在索引 32 处，您可以看到当发生切换时 I/Q 样本会出现不连续性。</font></font></p>
            <blockquote>
             <div>
              <div class="figure align-center"><img alt="../_images/IQ-sample-switching.png" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/IQ-sample-switching.png">
              </div>
             </div>
            </blockquote>
            <div class="admonition note">
             <p class="first admonition-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">笔记</font></font></p>
             <p class="last"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当确实存在相位差时，更容易看出相位不连续性。因此，在采集I/Q数据之前，请确保rtls_passive和rtls_slave之间的角度不为0度。</font></font></p>
            </div>
           </div>
           <div class="section" id="angle-compensation">
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">角度补偿</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#angle-compensation" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 AoA_getPairAngles() 下，我们将根据 I 和 Q 数据获取角度。之后，添加角度补偿。请参阅下面的代码。这是因为角度估计受天线对和频率的影响。p-&gt;gain、p-&gt;offset、channelOffset_A1 和 channelOffset_A2 的值基于实验室测量。不同的天线板设计和频率会给您不同的 p-&gt;gain、p-&gt;offset、channelOffset_A1 和 channelOffset_A2。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 AOA.c 中可以找到以下代码</font></font><code class="docutils literal notranslate"><span class="pre">AoA_getPairAngles()</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这是天线对补偿。</font></font></p>
            <blockquote>
             <div>
              <div class="literal-block-wrapper docutils container" id="id24">
               <div class="code-block-caption">
                <span class="caption-number"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 92.</font></font></span><span class="caption-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">天线对补偿</font></font></span><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id24" title="此代码的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a>
               </div>
               <div class="highlight-c notranslate">
                <table class="highlighttable">
                 <tbody>
                  <tr>
                   <td class="linenos">
                    <div class="linenodiv">
                     <pre>1
2
3
4
5
6</pre>
                    </div></td>
                   <td class="code">
                    <div class="highlight">
                     <pre><span></span><span class="c1">// Write back result for antenna pairs</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">pair</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">pair</span> <span class="o">&lt;</span> <span class="n">numPairs</span><span class="p">;</span> <span class="o">++</span><span class="n">pair</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">const</span> <span class="n">AoA_AntennaPair</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">gAoaReport</span><span class="p">.</span><span class="n">antConfig</span><span class="o">-&gt;</span><span class="n">pairs</span><span class="p">[</span><span class="n">pair</span><span class="p">];</span>
  <span class="n">gAoaReport</span><span class="p">.</span><span class="n">antResult</span><span class="o">-&gt;</span><span class="n">pairAngle</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)((</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">sign</span> <span class="o">*</span> <span class="n">antenna_versus_avg</span><span class="p">[</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">a</span><span class="p">][</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">offset</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">gain</span><span class="p">);</span>
<span class="p">}</span>
</pre>
                    </div></td>
                  </tr>
                 </tbody>
                </table>
               </div>
              </div>
              <div class="figure align-center"><img alt="图片来源：lab_tuning.png" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/lab_tuning.png">
              </div>
             </div>
            </blockquote>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从上图可以看出，应用偏移是为了确保在 0 度接收的数据在计算后将得出 0 度，然后改变斜率以使其与其余所有角度更好地契合。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">天线阵列 1 的补偿值可以在 ant_array1_config_boostxl_rev1v1.c 中找到</font></font><code class="docutils literal notranslate"><span class="pre">AoA_AntennaPair</span> <span class="pre">pair_A1[]</span></code></p>
            <blockquote>
             <div>
              <div class="literal-block-wrapper docutils container" id="id25">
               <div class="code-block-caption">
                <span class="caption-number"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 93.</font></font></span><span class="caption-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于补偿的值</font></font></span><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id25" title="此代码的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a>
               </div>
               <div class="highlight-c notranslate">
                <table class="highlighttable">
                 <tbody>
                  <tr>
                   <td class="linenos">
                    <div class="linenodiv">
                     <pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre>
                    </div></td>
                   <td class="code">
                    <div class="highlight">
                     <pre><span></span><span class="n">AoA_AntennaPair</span> <span class="n">pair_A1</span><span class="p">[]</span> <span class="o">=</span>
<span class="p">{</span>
   <span class="p">{</span><span class="c1">// v12</span>
    <span class="p">.</span><span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>       <span class="c1">// First antenna in pair</span>
    <span class="p">.</span><span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>       <span class="c1">// Second antenna in pair</span>
    <span class="p">.</span><span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>    <span class="c1">// Sign for the result</span>
    <span class="p">.</span><span class="n">offset</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="c1">// Measurement offset compensation</span>
    <span class="p">.</span><span class="n">gain</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">,</span> <span class="c1">// Measurement gain compensation</span>
   <span class="p">},</span>
   <span class="p">{</span><span class="c1">// v23</span>
    <span class="p">.</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">.</span><span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="p">.</span><span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">.</span><span class="n">offset</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span>
    <span class="p">.</span><span class="n">gain</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
   <span class="p">},</span>
   <span class="p">{</span><span class="c1">// v13</span>
    <span class="p">.</span><span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">.</span><span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="p">.</span><span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">.</span><span class="n">offset</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span>
    <span class="p">.</span><span class="n">gain</span> <span class="o">=</span> <span class="mf">0.50</span><span class="p">,</span>
   <span class="p">},</span>
<span class="p">};</span>
</pre>
                    </div></td>
                  </tr>
                 </tbody>
                </table>
               </div>
              </div>
             </div>
            </blockquote>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">继天线对补偿之后，我们添加了频率补偿。对于天线阵列 1，用于频率补偿的值可以在 ant_array1_config_boostxl_rev1v1.c 中找到</font><font style="vertical-align: inherit;">。</font></font><code class="docutils literal notranslate"><span class="pre">int8_t</span> <span class="pre">channelOffset_A1[40]</span></code><font style="vertical-align: inherit;"></font></p>
            <blockquote>
             <div>
              <div class="literal-block-wrapper docutils container" id="id26">
               <div class="code-block-caption">
                <span class="caption-number"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 94.</font></font></span><span class="caption-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于补偿的值</font></font></span><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id26" title="此代码的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a>
               </div>
               <div class="highlight-c notranslate">
                <table class="highlighttable">
                 <tbody>
                  <tr>
                   <td class="linenos">
                    <div class="linenodiv">
                     <pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre>
                    </div></td>
                   <td class="code">
                    <div class="highlight">
                     <pre><span></span><span class="kt">int8_t</span> <span class="n">channelOffset_A1</span><span class="p">[</span><span class="mi">40</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">2</span><span class="p">,</span> <span class="c1">// Channel 0</span>
                            <span class="mi">8</span><span class="p">,</span> <span class="c1">// Channel 1</span>
                           <span class="mi">14</span><span class="p">,</span> <span class="c1">// Channel 2</span>
                            <span class="mi">7</span><span class="p">,</span> <span class="c1">// Channel 3</span>
                           <span class="mi">12</span><span class="p">,</span> <span class="c1">// Channel 4</span>
                            <span class="mi">9</span><span class="p">,</span> <span class="c1">// Channel 5</span>
                            <span class="mi">9</span><span class="p">,</span> <span class="c1">// Channel 6</span>
                           <span class="mi">10</span><span class="p">,</span> <span class="c1">// Channel 7</span>
                            <span class="mi">7</span><span class="p">,</span> <span class="c1">// Channel 8</span>
                            <span class="mi">1</span><span class="p">,</span> <span class="c1">// Channel 9</span>
                            <span class="mi">6</span><span class="p">,</span> <span class="c1">// Channel 10</span>
                            <span class="mi">8</span><span class="p">,</span> <span class="c1">// Channel 11</span>
                           <span class="mi">14</span><span class="p">,</span> <span class="c1">// Channel 12</span>
                           <span class="mi">19</span><span class="p">,</span> <span class="c1">// Channel 13</span>
                           <span class="mi">21</span><span class="p">,</span> <span class="c1">// Channel 14</span>
                           <span class="mi">15</span><span class="p">,</span> <span class="c1">// Channel 15</span>
                          <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="c1">// Channel 16</span>
                            <span class="mi">0</span><span class="p">,</span> <span class="c1">// Channel 17</span>
                           <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="c1">// Channel 17</span>
                            <span class="mi">2</span><span class="p">,</span> <span class="c1">// Channel 18</span>
                            <span class="mi">7</span><span class="p">,</span> <span class="c1">// Channel 20</span>
                           <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="c1">// Channel 21</span>
                            <span class="mi">4</span><span class="p">,</span> <span class="c1">// Channel 22</span>
                            <span class="mi">0</span><span class="p">,</span> <span class="c1">// Channel 23</span>
                           <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="c1">// Channel 24</span>
                           <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="c1">// Channel 25</span>
                           <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="c1">// Channel 26</span>
                           <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="c1">// Channel 27</span>
                           <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="c1">// Channel 28</span>
                            <span class="mi">6</span><span class="p">,</span> <span class="c1">// Channel 29</span>
                            <span class="mi">3</span><span class="p">,</span> <span class="c1">// Channel 30</span>
                            <span class="mi">7</span><span class="p">,</span> <span class="c1">// Channel 31</span>
                            <span class="mi">4</span><span class="p">,</span> <span class="c1">// Channel 32</span>
                            <span class="mi">1</span><span class="p">,</span> <span class="c1">// Channel 33</span>
                            <span class="mi">4</span><span class="p">,</span> <span class="c1">// Channel 34</span>
                            <span class="mi">2</span><span class="p">,</span> <span class="c1">// Channel 35</span>
                            <span class="mi">0</span><span class="p">,</span> <span class="c1">// Channel 36</span>
                            <span class="mi">0</span><span class="p">,</span> <span class="c1">// Channel 37</span>
                            <span class="mi">0</span><span class="p">,</span> <span class="c1">// Channel 38</span>
                            <span class="mi">0</span><span class="p">,</span> <span class="c1">// Channel 39</span>
                           <span class="p">};</span>
</pre>
                    </div></td>
                  </tr>
                 </tbody>
                </table>
               </div>
              </div>
             </div>
            </blockquote>
           </div>
           <div class="section" id="aoa-functions-overview">
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AoA 功能概述</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#aoa-functions-overview" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节涵盖的函数均在 AOA.c 中。</font></font></p>
            <ol class="arabic">
             <li><p class="first"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AOA_初始化：</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于</font></font><code class="docutils literal notranslate"><span class="pre">rtls_passive</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设备，该函数负责以下硬件初始化。</font></font></p>
              <blockquote>
               <div>
                <ul class="simple">
                 <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始化 GPIO</font></font></li>
                 <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 I/O 切换模式</font></font></li>
                 <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将所需信号路由至 DMA 通道</font></font></li>
                 <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 GPTimer</font></font></li>
                </ul>
               </div>
              </blockquote><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于</font></font><code class="docutils literal notranslate"><span class="pre">rtls_slave</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设备，</font></font><code class="docutils literal notranslate"><span class="pre">AOA_init</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将获取 RF 覆盖表的大小。</font></font></p></li>
             <li><p class="first"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AOA_cteCap启用：</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于</font></font><code class="docutils literal notranslate"><span class="pre">rtls_passive</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设备来说，它提取用户通过NPI输入的以下3个参数，然后存储在RF RAM中：</font></font></p>
              <blockquote>
               <div>
                <ul class="simple">
                 <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cteScanOvs：这是 CTE 的 I/Q 采样率。</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#ctescanovs-var"><span class="std std-numref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表 22</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示此参数的可用值。开箱即用示例是使用 制作的</font><font style="vertical-align: inherit;">。</font></font><code class="docutils literal notranslate"><span class="pre">cteScanOvs</span> <span class="pre">=</span> <span class="pre">4</span></code><font style="vertical-align: inherit;"></font></li>
                 <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cteTime：CTE 的长度。允许范围是 2~20，以 8us 为单位。开箱即用</font><font style="vertical-align: inherit;">。被动模式下此参数用于计算可用的 I/Q 样本数。</font></font><code class="docutils literal notranslate"><span class="pre">cteTime</span> <span class="pre">=</span> <span class="pre">20</span></code><font style="vertical-align: inherit;"></font></li>
                 <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cteOffset：这给出了从 CTE 开始到采样开始的微秒数。允许的范围是 0~63。开箱即用的示例是</font><font style="vertical-align: inherit;">，这意味着无线电核心将在 CTE 开始时等待 4us 直到开始采样。如果此参数设置为大于实际 CTE 持续时间，则将</font><font style="vertical-align: inherit;">使用。</font></font><code class="docutils literal notranslate"><span class="pre">cteOffset</span> <span class="pre">=</span> <span class="pre">4</span></code><font style="vertical-align: inherit;"></font><code class="docutils literal notranslate"><span class="pre">cteOffset</span> <span class="pre">=</span> <span class="pre">4</span></code><font style="vertical-align: inherit;"></font></li>
                </ul>
               </div>
              </blockquote><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于</font></font><code class="docutils literal notranslate"><span class="pre">rtls_slave</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，此函数设置从属设备</font></font><code class="docutils literal notranslate"><span class="pre">cteTime*8us</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在每个连接数据包末尾发送带有的 CTE，方法是在最后一个覆盖（0xFFFFFFFF）结束之前添加 1 个额外覆盖。</font></font></p>
              <blockquote>
               <div>
                <span id="ctescanovs-var"></span>
                <div class="wy-table-responsive"><table border="1" class="docutils" id="id27">
                 <caption>
                  <span class="caption-number"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表 22. </font></font></span><span class="caption-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cteScanOvs 设置</font></font></span><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id27" title="此表的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a>
                 </caption>
                 <colgroup>
                  <col width="12%">
                  <col width="88%">
                 </colgroup>
                 <thead valign="bottom">
                  <tr class="row-odd">
                   <th class="head"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">价值</font></font></th>
                   <th class="head"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
                  </tr>
                 </thead>
                 <tbody valign="top">
                  <tr class="row-even">
                   <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></td>
                   <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对AoA包没有特殊处理。</font></font></td>
                  </tr>
                  <tr class="row-odd">
                   <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></td>
                   <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理标头中存在 AoA 的数据包并以 1 MHz 的频率对 CTE 进行采样。（不推荐，因为这提供的 I/Q 样本非常少）</font></font></td>
                  </tr>
                  <tr class="row-even">
                   <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></td>
                   <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理标头中存在 AoA 的数据包并以 2 MHz 的频率对 CTE 进行采样。</font></font></td>
                  </tr>
                  <tr class="row-odd">
                   <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></td>
                   <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理标头中存在 AoA 的数据包并以 3 MHz 的频率对 CTE 进行采样。</font></font></td>
                  </tr>
                  <tr class="row-even">
                   <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></td>
                   <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理标头中存在 AoA 的数据包并以 4 MHz 的频率对 CTE 进行采样。</font></font></td>
                  </tr>
                  <tr class="row-odd">
                   <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15</font></font></td>
                   <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理标头中存在 AoA 的数据包但不对 CTE 进行采样。</font></font></td>
                  </tr>
                 </tbody>
                </table></div>
               </div>
              </blockquote></li>
             <li><p class="first"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AOA_calcNumOfCteSamples</font></font></p>
              <blockquote>
               <div>
                <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此函数仅用于</font></font><code class="docutils literal notranslate"><span class="pre">rtls_passive</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设备确定 I/Q 样本数组的大小以及每个天线可用的样本数量。例如，如果我们取 cteScanOvs = 4、cteTime = 20 和 cteOffset = 4，那么我们应该得到 ( cteTime*8 - cteOffset ) * cteScanOvs = 624 个 I/Q 对。但是，无线电 RAM 最多只能存储 511 个 I/Q 对。当这种情况发生时，无线电核心一旦填满无线电 RAM 的 I/Q 存储区域，就会停止 I/Q 采样。</font></font></p>
               </div>
              </blockquote></li>
             <li><p class="first"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AOA_cteCapDisable</font></font></p>
              <blockquote>
               <div>
                <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于</font></font><code class="docutils literal notranslate"><span class="pre">rtls_passive</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设备，此功能将禁用 I/Q 采样并忽略标题中存在的 AoA。</font></font></p>
                <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于</font></font><code class="docutils literal notranslate"><span class="pre">rtls_slave</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设备来说，该函数将禁止从设备发送 CTE。</font></font></p>
               </div>
              </blockquote></li>
            </ol>
           </div>
          </div>
          <div class="section" id="aoa-application-overview">
           <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AoA 应用程序概述</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#aoa-application-overview" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置 rtls 示例以执行 AoA 的步骤在 simplelink_cc2640r2_sdk_x_xx_xx_xx/examples/rtos/CC2640R2_LAUNCHXL/blestack/rtls_master/readme.html 中进行了描述，请在设置项目时查看它。</font></font></p>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于不熟悉编辑预定义符号/预处理器符号的用户，请查看</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/cc2640/developing_in_ccs.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#sec-developing-with-ccs-accessing-preprocessor-symbols"><span class="std std-ref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问预处理器符号</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/cc2640/developing_in_iar.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#sec-developing-with-iar-accessing-preprocessor-symbols"><span class="std std-ref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问预处理器符号</font></font></span></a></p>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在开箱即用的软件中，</font></font><code class="docutils literal notranslate"><span class="pre">rtls_master</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="docutils literal notranslate"><span class="pre">rtls_slave</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将形成 BLE 连接。建立连接后，</font></font><code class="docutils literal notranslate"><span class="pre">rtls_master</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将通过 UART 向 PC 发送连接信息，然后节点管理器将这条信息传递给</font></font><code class="docutils literal notranslate"><span class="pre">rtls_passive</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以跟踪连接的 PC。</font></font></p>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，节点管理器设置 AoA 参数</font></font><code class="docutils literal notranslate"><span class="pre">master</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="docutils literal notranslate"><span class="pre">passive</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后</font></font><code class="docutils literal notranslate"><span class="pre">master</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过无线电发送数据包给从属设备以设置 CTETime。</font></font></p>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此后，</font></font><code class="docutils literal notranslate"><span class="pre">rtls_master</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将通过空中向</font></font><code class="docutils literal notranslate"><span class="pre">rtls_slave</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="docutils literal notranslate"><span class="pre">rtls_passive</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有线方式发送开始 AoA 请求，然后</font></font><code class="docutils literal notranslate"><span class="pre">rtls_slave</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在每个连接数据包末尾附加 CTE。</font></font></p>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rtls_passive 可以进行 I/Q 采样并根据 ConnectionCTE 数据包计算角度。</font></font></p>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面的序列图说明了开箱即用示例如何工作的整个过程。</font></font></p>
           <div class="figure align-center" id="id28">
            <p class="plantuml"><img src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/plantuml-f097213f221261b57729189aee0be61d9947f339.png" alt="@startuml 参与者 rtls_passive 作为被动参与者 “Node_Manager \n(Host MCU)” 作为管理器参与者 rtls_master 作为主参与者 rtls_slave 作为从属管理器 -&gt; 主：RTLS_CMD_IDENTIFY_Req 主 -&gt; 管理器：RTLS_CMD_IDENTIFY_Rsp 管理器 -&gt; 被动：RTLS_CMD_IDENTIFY_Req 被动 -&gt; 管理器：RTLS_CMD_IDENTIFY_Rsp 管理器 -&gt; 主：RTLS_CMD_SCAN_Req 激活主 主 -&gt; 主：开始扫描 \n对于 rtls_slave 组 rtls_slave 未找到管理器 -&gt; 主：RTLS_CMD_SCAN_STOP 停用主 管理器 -&gt; 主：RTLS_CMD_SCAN_Req \n重新开始扫描激活主 主 -&gt; 主：开始扫描 \n对于 rtls_slave 管理器 -&gt; 主：RTLS_CMD_SCAN_STOP 停用主 ...... 重复直到找到设备 ... ... 结束组 rtls_slave 找到 主机 -&gt; 管理器：RTLS_CMD_SCAN_AsyncReq 管理器 -&gt; 主机：RTLS_CMD_SCAN_STOP 管理器 -&gt; 主机：RTLS_CMD_CONNECT 主机 --&gt; 从机：连接请求 == 建立连接后 == 主机 -&gt; 管理器：RTLS_CMD_CONN_PARAMS 管理器 -&gt; 被动机：RTLS_CMD_CONN_PARAMS \n传递连接信息 \n以便被动机跟踪连接组 AoA 管理器 -&gt; 主机：RTLS_CMD_AOA_SET_PARAMS 主机 --&gt; 从机：RTLS_REMOTE_CMD_AOA_SET_PARAMS 管理器 -&gt; 被动机：RTLS_CMD_AOA_SET_PARAMS 管理器 -&gt; 主机：RTLS_CMD_AOA_ENABLE 主机 --&gt; 从机：启用使用 CTE 发送 \n数据包 管理器 -&gt; 被动机：RTLS_CMD_AOA_ENABLE 激活被动机 被动机 -&gt; 被动机：开始跟踪连接 \n并等待连接 CTE 数据包 从机 --&gt; 主机：连接 CTE 数据包 主机--&gt; 从机：空数据包 被动 -&gt; 被动：收到连接 CTE 数据包 \n然后计算从机与被动机之间的角度 \n 被动 -&gt; 管理器：RTLS_CMD_AOA_RESULT_ANGLE ... ... 主机与从机保持连接 ... ... 被动跟踪连接并计算角度 ... ... 结束 结束 @enduml"></p>
            <p class="caption"><span class="caption-number"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 77.</font></font></span><span class="caption-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 RTLS AoA 网络并启用 AoA</font></font></span><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id28" title="此图片的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></p>
           </div>
          </div>
         </div>
         <div class="section" id="time-of-flight"><span id="sec-tof"></span>
          <h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">飞行时间</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#time-of-flight" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h2>
          <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TI 飞行时间 (ToF) 是一种专有技术，通过测量 RF 数据包交换的往返延迟来实现安全范围界定。</font></font></p>
          <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是在主从被动配置中实现的，其中主设备发送挑战，从设备在固定的周转时间后返回响应。然后，主设备可以通过测量传输挑战和接收响应之间的时间差，减去（已知的）固定周转时间来计算往返延迟。被动不会参与无线交换，但也会测量观察到的飞行时间。</font></font></p>
          <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于无线电采样时钟频率的低速特性，在光速环境下评估时，每次测量只能提供非常粗略的结果。但通过进行多次测量（通常在几毫秒内进行数百次测量），可以获得更精确的平均结果。</font></font></p>
          <div class="section" id="theory-of-operation">
           <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作原理</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#theory-of-operation" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">很少有东西能比光速更快，而光速是已知的，并且恒定为</font></font><cite><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c</font></font></cite><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。电磁波以光速传播，因此 RF 数据包以光速传播。</font></font></p>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于速度是恒定的，这意味着波传播所需的时间与距离成正比。要找到与物体的距离，我们可以记录传输某物的时间戳，并将其与接收反射时的时间戳进行比较，除以二并乘以 c </font></font><cite><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></cite><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这也是雷达等的工作原理。</font></font></p>
           <div class="figure" id="id29"><img alt="图片来源：tof_reflection.png" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/tof_reflection.png">
            <p class="caption"><span class="caption-number"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 78。</font></font></span><span class="caption-text"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反射的电磁波。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果发射和接收之间的时间为</font></font><cite><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></cite><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则距离</font></font><cite><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></cite><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">就是</font></font><cite><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ct/2</font></font></cite><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></span></p>
           </div>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与雷达相反，反射器</font><font style="vertical-align: inherit;">被认为是</font><cite><font style="vertical-align: inherit;">主动的</font></cite><font style="vertical-align: inherit;">，因为它不会有意义地反射传出信号，而是必须主动发出“反射”。</font></font><code class="docutils literal notranslate"><span class="pre">TI</span> <span class="pre">ToF</span></code><font style="vertical-align: inherit;"></font><cite><font style="vertical-align: inherit;"></font></cite><font style="vertical-align: inherit;"></font></p>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行这种形式的测量至少面临两个主要挑战：</font></font></p>
           <ul class="simple">
            <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反射器在接收</font></font><code class="docutils literal notranslate"><span class="pre">PING</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和传输之间所用的时间</font></font><code class="docutils literal notranslate"><span class="pre">PONG</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将影响测量的距离。</font></font></li>
            <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">光需要</font></font><cite><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3 纳秒</font></font></cite><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">才能传播一米，这意味着测量飞行时间的时钟的滴答速度必须至少为</font></font><cite><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">303 MHz</font></font></cite><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">才能获得 1 米的空间分辨率。</font></font></li>
           </ul>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TI ToF 解决方案通过在从属/反射器设备中实现确定性的周转时间克服了第一个挑战。</font></font></p>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第二个挑战是通过采用统计方法测量距离来克服的。用于测量飞行时间的无线电定时器的频率为 8 MHz，这意味着时间分辨率为 125 ns。通过对单个数据包测量进行过采样，可以提高最终测量的准确性。这是因为样本中存在抖动，并且该抖动具有正态分布。为了实现更高的精度，将在多个设备上进行多次 PING/PONG 交换来测量飞行时间。分辨率将在</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#sec-tof-resolution"><span class="std std-ref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分辨率部分进一步讨论，精度将在</font></font></span></a><font style="vertical-align: inherit;"></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#sec-tof-accuracy"><span class="std std-ref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">精度</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分讨论</font><font style="vertical-align: inherit;">。</font></font></p>
           <div class="section" id="terminology">
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">术语</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#terminology" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <blockquote>
             <div>
              <ul class="simple">
               <li><code class="docutils literal notranslate"><span class="pre">PING</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：发送用于启动 ToF 测量的数据包</font></font></li>
               <li><code class="docutils literal notranslate"><span class="pre">PONG</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：PING 的响应数据包</font></font></li>
               <li><code class="docutils literal notranslate"><span class="pre">Run/burst</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：用于测量距离的一系列 PING/PONG 交换</font></font></li>
               <li><code class="docutils literal notranslate"><span class="pre">Tick</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：用于测量 ToF 的 RF 核心时钟的单个周期</font></font></li>
               <li><code class="docutils literal notranslate"><span class="pre">Sample</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：单次 PING/PONG 交换的测量 RSSI、tick 和信道信息</font></font></li>
              </ul>
             </div>
            </blockquote>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概括来说，ToF 突发是 PING/PONG 交换的集合。每次 PING/PONG 交换都会产生一个 ToF 样本，该样本是 RSSI、时间戳（以滴答数表示）和频率信息的集合。突发可以包含可配置数量的 PING/PONG 交换，并且可以在可配置的频率列表上运行。在突发结束时，可以对所有滴答信息进行平均以形成距离估计值。来自多个设备的多个突发的信息可以组合起来，以在给定的置信区间内形成距离测量值。</font></font></p>
           </div>
           <div class="section" id="id5">
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据包格式</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id5" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调制格式为 2Mbps，偏移为 500kHz，使用分段线性整形器进行转换。数据包内容基于标准 BLE 数据包，并进行了一些修改以满足 ToF 使用情况。</font></font></p><img alt="../_images/aafi-4fadc1f06cdb5c6e1840f210234afcf241e49176.png" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/aafig-4fadc1f06cdb5c6e1840f210234afcf241e49176.png">
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些数据包包含一个随机预共享同步字，该同步字对于通过无线方式发送的每个帧都是唯一的，并且双方都会在其 RX 周期中监听该同步字。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同步字是 RF 电路检测数据包是否发往设备的方式，也是为测量生成时间戳的方式。</font></font></p>
            <div class="section" id="packet-types"><span id="sec-tof-packet-types"></span>
             <h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据包类型</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#packet-types" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h5>
             <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行飞行时间时，RF核心将发送两种类型的数据包：</font></font></p>
             <blockquote>
              <div>
               <ul class="simple">
                <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测量包：用于执行安全距离测量</font></font></li>
                <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">广播数据包：用于同步被动节点，不</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">距离测量</font></font></li>
               </ul>
              </div>
             </blockquote>
             <p><font style="vertical-align: inherit;"></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#sec-tof-security"><span class="std std-ref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测量数据包将使用由安全</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块生成的随机同步字</font><font style="vertical-align: inherit;">，这些数据包的有效载荷字段不被使用。广播数据包则使用恒定同步字并利用有效载荷字段来共享同步信息。广播数据包的目的是同步被动节点。被动节点的概念将在下一节中解释。广播数据包的有效载荷如下所示：</font></font></p><img alt="../_images/aafi-01b89c34dc3ae962937e2f7dc94a9726ac43c02f.png" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/aafig-01b89c34dc3ae962937e2f7dc94a9726ac43c02f.png">
             <div class="admonition note">
              <p class="first admonition-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">笔记</font></font></p>
              <p class="last"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 中的安全性取决于良好的同步字生成算法。同步字不应被攻击者轻易猜出，也不应重复。相反，它们应该以某种方式生成，使得受信任的 ToF 节点能够确定下一个同步字，而攻击者无法确定。请参阅</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#sec-tof-security"><span class="std std-ref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全性</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。由于广播数据包不用于距离测量，因此它们可以安全地使用恒定同步字。</font></font></p>
             </div>
            </div>
           </div>
           <div class="section" id="tof-roles">
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 角色</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#tof-roles" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF解决方案支持三种角色。</font></font></p>
            <blockquote>
             <div>
              <ul class="simple">
               <li><code class="docutils literal notranslate"><span class="pre">Master</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：通过发送 PING 启动 ToF 序列</font></font></li>
               <li><code class="docutils literal notranslate"><span class="pre">Slave</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：监听 PING，用 PONG 响应</font></font></li>
               <li><code class="docutils literal notranslate"><span class="pre">Passive</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：监听 PING 和 PONG</font></font></li>
              </ul>
             </div>
            </blockquote>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主设备和被动设备将使用 RF 核心中的计时器测量飞行时间。虽然被动设备并非严格要求运行 ToF，但它将通过在测量中添加额外样本来提高测量的稳健性并提供空间分集。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于 ToF 是一种统计测量，因此样本越多，给定测量的置信度就越高。无源节点还可以增加空间分集，并可以减少 ToF 测量中的反射和多径衰落的影响。可以添加的无源节点数量没有限制，但必须至少有一个主节点和一个从节点。</font></font></p>
            <p><font style="vertical-align: inherit;"></font><code class="docutils literal notranslate"><span class="pre">Passive</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须知道和</font><font style="vertical-align: inherit;">之间的距离</font></font><code class="docutils literal notranslate"><span class="pre">Master</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这样才能校准出这个距离。</font></font></p>
           </div>
           <div class="section" id="tof-protocol">
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 协议</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#tof-protocol" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"></font><code class="docutils literal notranslate"><span class="pre">Master</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">设备</font></font><code class="docutils literal notranslate"><span class="pre">Slave</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将在应用程序提供的一系列频率内进行监听和传输。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同时，设备将监听在</font><font style="vertical-align: inherit;">它们实现同步之间</font><font style="vertical-align: inherit;">和之后</font></font><code class="docutils literal notranslate"><span class="pre">Passive</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传输的所有数据包。</font></font><code class="docutils literal notranslate"><span class="pre">Master</span></code><font style="vertical-align: inherit;"></font><code class="docutils literal notranslate"><span class="pre">Slave</span></code><font style="vertical-align: inherit;"></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初在第一个频率上处于接收模式</font></font><code class="docutils literal notranslate"><span class="pre">Slave</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且正在监听第一个</font></font><code class="docutils literal notranslate"><span class="pre">syncword</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SW0，这就是</font></font><code class="docutils literal notranslate"><span class="pre">PING</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果从属设备在初始监听期内收到匹配的数据包，它将发送</font></font><code class="docutils literal notranslate"><span class="pre">PONG</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并开始按照时隙方案改变频率和同步字。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设备</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将发送一个包含第一个同步字（SW0）和一些应用程序定义的有效负载的数据包。此后，它将立即进入接收模式并等待从设备回复，发送数组中的第二个同步字（SW1）。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类似地，如果主机</font></font><code class="docutils literal notranslate"><span class="pre">ACK/PONG</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">响应初始接收到匹配的数据包</font></font><code class="docutils literal notranslate"><span class="pre">PING</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它将遵循相同的时隙和跳频方案。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被动设备将以 RX 模式开始，等待 SW2。一旦</font></font><code class="docutils literal notranslate"><span class="pre">Passive</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接收到 SW2，它将开始遵循时隙和跳频方案。</font></font><code class="docutils literal notranslate"><span class="pre">Passive</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在接收到 SW2n 时启动无线电计时器，然后在</font></font><code class="docutils literal notranslate"><span class="pre">Passive</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接收到 SW2n+1 后停止计时器。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TOF Master 会定期发送广播数据包。与测量数据包不同，它们使用恒定同步字，并包含嵌入在有效载荷中的共享计数器 ( </font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/reference.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#term-sctr"><span class="xref std std-term"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SCTR</font></font></span></a><font style="vertical-align: inherit;"></font><code class="docutils literal notranslate"><span class="pre">tofBroadcast.period</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )。广播数据包的目的是同步被动设备。可以通过更改</font><font style="vertical-align: inherit;">来配置广播数据包的周期</font></font><code class="docutils literal notranslate"><span class="pre">TOF.c</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
            <div class="admonition note">
             <p class="first admonition-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">笔记</font></font></p>
             <p class="last"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">广播包不用于距离测量。</font></font></p>
            </div>
            <div class="figure" id="id30">
             <p class="plantuml"><img src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/plantuml-2d6aacee3fd4049d2faf72c38c82f695b8a39b1c.png" alt="@startuml 参与者“主设备”作为主设备 参与者“被动设备”作为被动设备 参与者“从设备”作为从设备 == 初始同步 == rnote 通过被动 RX：等待 SW2 结束 rnote 主设备 -&gt; 从设备：SW&lt;sub&gt;0&lt;/sub&gt; 频率&lt;sub&gt;0&lt;/sub&gt; PING 激活主设备 主设备 -&gt; 从设备：SW&lt;sub&gt;1&lt;/sub&gt; 主设备 -&gt; 从设备：无同步停用主设备 从设备 -&gt; 从设备：输入初始 \nRX：SW&lt;sub&gt;0&lt;/sub&gt; + 频率&lt;sub&gt;0&lt;/sub&gt; 激活从设备 主设备 -&gt; 从设备：Tx：SW&lt;sub&gt;0&lt;/sub&gt; 频率&lt;sub&gt;0&lt;/sub&gt; PING 激活主设备 主设备 -&gt; 从设备：SW&lt;sub&gt;1&lt;/sub&gt; RX 从设备 -&gt; 从设备：SW&lt;sub&gt;1&lt;/sub&gt; PONG 停用从设备 停用主设备 == 时隙 == 注意 通过主设备、从设备 从这里，即使没有同步，设备也会进入下一个通道 已收到。 结束注释 从机 -&gt; 从机：SW&lt;sub&gt;2&lt;/sub&gt; + 频率&lt;sub&gt;1&lt;/sub&gt; RX 激活从机 主机 -&gt; 从机：SW&lt;sub&gt;2&lt;/sub&gt; 频率&lt;sub&gt;1&lt;/sub&gt; PING 激活被动 rnote 通过被动 启动计时器 结束 rnote 激活主机 主机 -&gt; 主机：SW&lt;sub&gt;3&lt;/sub&gt; RX 从机 -&gt; 主机：SW&lt;sub&gt;3&lt;/sub&gt; 频率&lt;sub&gt;1&lt;/sub&gt; PONG rnote 通过被动 停止计时器 结束 rnote 停用从机 停用主机 停用被动循环 从机 -&gt; 从机：SW&lt;sub&gt;n&lt;/sub&gt; + 频率&lt;sub&gt;m&lt;/sub&gt; RX 激活从机 主机 -&gt; 从机：SW&lt;sub&gt;n&lt;/sub&gt; 频率&lt;sub&gt;m&lt;/sub&gt; PING 激活被动 rnote 通过被动 启动计时器 结束 rnote 激活主机 主机 -&gt; 主机：SW&lt;sub&gt;n+1&lt;/sub&gt; RX 从机-&gt; 主机：SW&lt;sub&gt;n+1&lt;/sub&gt; Freq&lt;sub&gt;m&lt;/sub&gt; PONG rnote over Passive 停止定时器结束 rnote 停用从机 停用主机 停用被动结束组广播数据包 激活主机 激活被动 激活从机 主机 -&gt; 从机：SW&lt;sub&gt;const&lt;/sub&gt; Freq&lt;sub&gt;m&lt;/sub&gt; [SCTR CRC] 停用从机 停用被动 停用主机结束组循环 从机 -&gt; 从机：SW&lt;sub&gt;n&lt;/sub&gt; + Freq&lt;sub&gt;m&lt;/sub&gt; RX 激活从机 主机 -&gt; 从机：SW&lt;sub&gt;n&lt;/sub&gt; Freq&lt;sub&gt;m&lt;/sub&gt; PING 激活被动 rnote over Passive 启动定时器结束 rnote 激活主机 主机 -&gt; 主机：SW&lt;sub&gt;n+1&lt;/sub&gt; RX 从机 -&gt; 主机：SW&lt;sub&gt;n+1&lt;/sub&gt; Freq&lt;sub&gt;m&lt;/sub&gt; PONG rnote over Passive 停止定时器结束rnote 停用从属设备 停用主设备 停用被动设备 结束 ... @enduml"></p>
             <p class="caption"><span class="caption-number"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 79. </font></font></span><span class="caption-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 测量突发序列</font></font></span><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id30" title="此图片的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></p>
            </div>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们考虑数据包的时间，我们可以尝试将飞行时间说明为下方前两条垂直线之间的距离。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以看到两个设备的内部时钟不同步，如每个设备的顶行所示，并且您可以看到 ToF 测量的三个阶段：</font></font></p>
            <ol class="arabic simple">
             <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主站发送 PING，从站接收</font></font></li>
             <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设备切换 RF 角色，TX 到 RX 和 RX 到 TX</font></font></li>
             <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">响应 PONG 已发送</font></font></li>
            </ol>
            <div class="figure" id="id31"><img alt="图 2. tof 的时间" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/tof_timing.png">
             <p class="caption"><span class="caption-number"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 80. </font></font></span><span class="caption-text"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 时序图。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参见下方图例。</font></font></span></p>
             <div class="legend"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T </font></font></strong><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 主机发送挑战 PING，</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T </font></font></strong><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 主机 TX/RX 开关，</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T </font></font></strong><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 主机检测 SW 相关性，</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T </font></font></strong><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 从机检测 SW 相关性，</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T </font></font></strong><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 从机 TX/RX 开关，</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T </font></font></strong><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 从机发送响应 PONG，
             </font></font></div>
            </div>
           </div>
           <div class="section" id="resolution"><span id="sec-tof-resolution"></span>
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解决</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#resolution" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 中的距离以 8MHz 频率运行的无线电定时器的刻度来测量。必须将这些刻度值转换为米，才能估算与从属设备的距离。距离方程用于执行转换。本节旨在逐步展示刻度到米的转换常数。</font></font></p>
            <div class="math">
             <p><img src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/9c1d98aa7eecb9654fe1a72e434edea1664dfd83.svg" alt="\begin{align*} \text{距离} = \frac{1}{2}\times\text{t}\times\text{c} \end{align*}"></p>
            </div>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于 ToF 数据包是电磁波，其传播速率固定为</font></font><code class="docutils literal notranslate"><span class="pre">c</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即光传播一米所需的时间。结果必须除以 2，因为该时间考虑了数据包的往返行程时间，是实际距离的 2 倍。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了将滴答值转换为时间，必须将其除以 RF 核心定时器的频率。将其代入上面的距离方程式可得出将滴答转换为米所使用的比例因子。</font></font></p>
            <div class="math">
             <p><img src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/1abcea4791d74fc4b5ceaac4f74f7c9f37b581b1.svg" alt="\begin{align*} \begin{split} \text{距离} &amp;= \frac{1}{2}\times\text{t}\times\text{c}\\[16pt] &amp;= \frac{1}{2}\times\frac{\text{tick}}{8\si{\mega\hertz}}\times\text{c}\\[16pt] &amp;= \frac{\text{tick}}{2\times8\times10^{6}\text{s}^{-1}} \times 3\times10^{8}\si{\meter/\second}\\[16pt] &amp;= 18.75\si{\meter}\times\text{tick} \end{split} \end{align*}"></p>
            </div>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 数据包</font></font><code class="docutils literal notranslate"><span class="pre">18.75</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每刻将传输米。在软件中，此常数称为</font></font><code class="docutils literal notranslate"><span class="pre">TICK_TO_METER</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。要将刻度值转换为米，只需乘以</font></font><code class="docutils literal notranslate"><span class="pre">TICK_TO_METER</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
           </div>
           <div class="section" id="accuracy"><span id="sec-tof-accuracy"></span>
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">准确性</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#accuracy" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有两种物理现象有助于以下推导：</font></font></p>
            <blockquote>
             <div>
              <ul class="simple">
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设备内部时钟和振荡器的抖动和相位噪声</font></font></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行 ToF 的设备（例如主设备和从设备）之间的同步时钟</font></font></li>
              </ul>
             </div>
            </blockquote>
            <p><font style="vertical-align: inherit;"></font><a class="reference external" href="https://translate.google.com/website?sl=auto&amp;tl=zh-CN&amp;hl=en&amp;client=webapp&amp;u=https://www.ti.com/product/CC2640R2F"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CC2640R2F</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的 RF 核心内部</font><font style="vertical-align: inherit;">有一个称为相关器的组件。相关器负责测量两个同步字之间的相关值。当 RF 核心运行 ToF 命令时，相关器负责启动和停止测量 ToF 滴答的计时器。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 拓扑中的各种设备没有同步时钟的方法，因此发射器和接收器中的符号时钟之间存在一些固有的随机偏移。这意味着在多个 ToF 样本中，相关器报告同步的时间会略有漂移。下面的 gif 说明了这一点。</font></font></p>
            <blockquote>
             <div>
              <div class="figure align-center"><img alt="../_images/ToF_correlator_gif.gif" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/ToF_correlator_gif.gif">
              </div>
             </div>
            </blockquote>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相关器负责启动和停止报告 ToF 刻度的计时器。相位噪声会导致“同步发现”时间点的扩散，从而导致 ToF 结果的扩散。同步发现点的扩散会导致 ToF 结果在相邻刻度值之间扩散。TI 观察到的方差约为 0.64。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 拓扑中的各种设备没有同步时钟的方法，因此彼此之间的时钟存在一些固有的偏移。执行 ToF 的设备之间的刻度值分布不会同步。最终，这意味着结果将分布在整个系统的 3-4 个刻度值上。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于具有统计意义的集合，系统中的刻度分布可以近似为正态分布，真实值是平均值。下面打印了 ToF 运行中刻度的示例直方图，并叠加了可能的密度函数。</font></font></p>
            <blockquote>
             <div>
              <div class="figure align-center"><img alt="../_images/tof_probability.png" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/tof_probability.png">
              </div>
             </div>
            </blockquote>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们使用 ToF 运行中样本稍多一些的具体示例，例如 7400。将 ToF 结果绘制为给定距离和样本数的直方图，可得到与下图类似的结果。</font></font></p>
            <blockquote>
             <div>
              <div class="figure align-center"><img alt="../_images/tof_run_histogram.png" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/tof_run_histogram.png">
              </div>
             </div>
            </blockquote>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用基于上述直方图的具体示例，我们得到以下结果：</font></font></p>
            <div class="math">
             <p><img src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/ba7cd4c8cf60d4e87832eacff3bac1ed43e854ff.svg" alt="\begin{align*} \begin{split} \text{$count_{483}$} = 1200\\ \text{$count_{484}$} = 3700\\ \text{$count_{485}$} = 2500\\ count_{total} = 7400 \end{split} \end{align*}"></p>
            </div>
            <p><font style="vertical-align: inherit;"></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#sec-tof-calib"><span class="std std-ref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在真正的距离计算中，我们必须考虑校准。校准</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分将深入介绍校准</font><font style="vertical-align: inherit;">。现在，假设校准值以刻度为单位测量，并且为</font></font><code class="docutils literal notranslate"><span class="pre">484</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
            <div class="math">
             <p><img src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/dc6fb50dd08411a4e49abc687193cc37348124f3.svg" alt="\begin{align*} \text{距离} = 18.75\si{\米}\times\text{$tick_{avg}$} - 18.75\si{\米}\times\text{calib} \end{align*}"></p>
            </div>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代入上面直方图的结果可得</font></font></p>
            <div class="math">
             <p><img src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/2726168712dd048ee755b74e2d71a11f71f0b1cf.svg" alt="\begin{align*} \begin{split} \text{$tick_{avg}$} &amp;= \frac{\text{$count_{483}$}\times483}{count_{total}} + \frac{\text{$count_{484}$}\times484}{count_{total}} + \frac{\text{$count_{485}$}\times485}{count_{total}}\\[16pt] &amp;= 484.1756757 \end{split} \end{align*}"></p>
            </div>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将代入</font></font><code class="docutils literal notranslate"><span class="pre">tick_avg</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后的方程可得出以下结果：</font></font></p>
            <div class="math">
             <p><img src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/a8b35afd69cbb5cde1bc8e3a71b5954dc7c7626b.svg" alt="\begin{align*} \begin{split} \text{距离} &amp;= (18.75\si{\米}\times\ 484.1756757) - (18.75\si{\米}\times\ 484)\\ &amp;= 1.88m \end{split} \end{align*}"></p>
            </div>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此示例展示了 ToF 随着样本数量的增加而变得更加精确的概念。它还展示了 ToF 如何使用于测量小于 18.75 米的距离，这是由于设备之间时钟不同步以及各个设备中的相位噪声/漂移引起的扩散。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般的想法是，样本越多，在给定的置信水平下实现更窄的置信区间就越有可能。请参阅 ToF SLA 中的计算器和说明</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：准确度和置信区间部分</font></font></strong> <a class="reference external" href="https://translate.google.com/website?sl=auto&amp;tl=zh-CN&amp;hl=en&amp;client=webapp&amp;u=http://dev.ti.com/tirex/explore/node?node%3DACP.5TgBewoekI7wJPX1VQ__krol.2c__LATEST"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.ti.com/simplelinkacademy</font></font></a></p>
           </div>
           <div class="section" id="tof-time-slot-and-frequency-hopping"><span id="sec-tof-time-slot"></span>
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 时隙和跳频</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#tof-time-slot-and-frequency-hopping" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">飞行时间可以在多个频率上运行，执行跳频。在开始 ToF 测量之前，所有设备必须就频率列表和跳频间隔达成一致。</font></font><code class="docutils literal notranslate"><span class="pre">CMD_FS</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于将频率合成器 (FS) 编程为给定频率。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一次使用前必须对频率合成器进行粗校准</font></font><code class="docutils literal notranslate"><span class="pre">ToF_run()</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，建议每小时重新校准一次。打开和关闭 ToF 驱动程序将触发粗校准。有关更多信息，请参阅</font></font><code class="docutils literal notranslate"><span class="pre">TOF_calibrateSynth()</span></code></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">粗校准完成后，</font></font><code class="docutils literal notranslate"><span class="pre">CMD_TOF</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将处理 RF 核心内部中频的精细校准。</font></font><code class="docutils literal notranslate"><span class="pre">CMD_FS</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行前无需</font></font><code class="docutils literal notranslate"><span class="pre">CMD_TOF</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用。ToF 命令可分为两部分</font></font></p>
            <blockquote>
             <div>
              <ul class="simple">
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">精细FS校准：120us</font></font></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF测量：400us</font></font></li>
              </ul>
             </div>
            </blockquote>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样，首次跳转到新信道时，时隙为 520 us，而在该信道上进行剩余测量时，时隙为 400 us。建议在多个频率上执行 ToF，因为多径衰落与频率有关。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">频率合成器在调用后的第一次运行期间也会进行一次预校准</font></font><code class="docutils literal notranslate"><span class="pre">TOF_open()</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且存储校准值。</font></font></p>
           </div>
           <div class="section" id="link-quality-indication-lqi-and-multi-path-filtering"><span id="sec-tof-lqi-and-filtering"></span>
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链路质量指示 (LQI) 和多路径过滤</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#link-quality-indication-lqi-and-multi-path-filtering" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多径衰落引起的建设性干扰可能导致非常高的</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/reference.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#term-lqi"><span class="xref std std-term"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LQI</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测量值。在多径反射上测量 ToF 是不可取的，因为它不是真实距离的指示。（非直接路径）。总之，非常高的 LQI 测量值通常表示数据包已受到多径的影响。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF RF 补丁包含一个参数，用于在作为从设备时忽略 LQI 过高的数据包。此外，它还能够导出主设备和被动设备的 LQI 结果。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，对 LQI 执行的过滤类型如下：</font></font></p>
            <blockquote>
             <div>
              <ul class="simple">
               <li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RF 核心</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上</font><font style="vertical-align: inherit;">：LQI 高于阈值的数据包未得到响应</font></font><code class="docutils literal notranslate"><span class="pre">ToF</span> <span class="pre">slave</span></code><font style="vertical-align: inherit;"></font></li>
               <li><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 上的</font><strong><font style="vertical-align: inherit;">应用程序核心</font></strong></font><code class="docutils literal notranslate"><span class="pre">Master</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><code class="docutils literal notranslate"><span class="pre">Passive</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LQI 高于阈值的本地测量值将被丢弃</font></font></li>
              </ul>
             </div>
            </blockquote>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从节点上的 RF 核心 LQI 过滤可通过</font></font><code class="docutils literal notranslate"><span class="pre">lqiThreshold</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 命令的参数进行配置。这可通过</font></font><code class="docutils literal notranslate"><span class="pre">slaveLqiFilter</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLSCtrl 参数从应用程序核心进行设置。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序核心 LQI 过滤是作为 的一部分实现的</font></font><code class="docutils literal notranslate"><span class="pre">TOF_getBurstStat()</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。可以通过更改</font></font><code class="docutils literal notranslate"><span class="pre">postProcessLqiThresh</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLSCTRL 参数来设置阈值。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总之，对</font></font><code class="docutils literal notranslate"><span class="pre">PING</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及</font></font><code class="docutils literal notranslate"><span class="pre">PONG</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据包都执行​​ LQI 过滤。</font></font></p>
            <blockquote>
             <div>
              <ul class="simple">
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从属设备接收到 LQI 高于阈值的数据包，它将不会响应（导致该 SW 超时）</font></font></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PING/PONG 成功完成，但主控或被动设备测量到返回数据包的 LQI 过高。这将在应用程序核心上被过滤掉。</font></font></li>
              </ul>
             </div>
            </blockquote>
            <div class="admonition hint">
             <p class="first admonition-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">暗示</font></font></p>
             <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当 LQI 或幅度差滤波器设置得过于激进时，系统实际上可能会在突发期间过滤掉许多样本。这可能看起来没有 ToF 连接，而实际上样本正在被过滤掉。在使用突发之前，重要的是确保 ToF 结果仍然具有统计意义（即使用了足够的样本来得出距离估计）。</font></font></p>
             <p class="last"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用它</font></font><code class="docutils literal notranslate"><span class="pre">RTLS_CMD_TOF_RESULT_RAW</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来观察所有样本而无需进行过滤。另请参阅</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#sec-tof-debug-stat"><span class="std std-ref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试统计信息</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
            </div>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多径干扰的另一个迹象是 &lt;&lt;1&gt;&gt; 和 &lt;&lt;0&gt;&gt; 符号中接收的 RSSI 不一致。ToF PHY 使用的调制方案是频移键控 ( </font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/reference.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#term-fsk"><span class="xref std std-term"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FSK</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )，因此每个符号都与载波的正或负频率偏差相关。多径的影响是频率选择性的，因此它们将对 &lt;&lt;1&gt;&gt; 和 &lt;&lt;0&gt;&gt; 符号产生不同的影响。ToF 补丁还可以为每个 ToF 样本输出 &lt;&lt;1&gt;&gt; 和 &lt;&lt;0&gt;&gt; 符号的幅度差异比。基于幅度差异的过滤在应用程序核心中作为 的一部分实现</font></font><code class="docutils literal notranslate"><span class="pre">TOF_getBurstStat()</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。幅度差异阈值可以通过 RTLSCtrl 命令设置</font></font><code class="docutils literal notranslate"><span class="pre">postProcessMagnRatio</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最终，使用正确设置的 LQI 和幅度差异滤波器可以抵消多径干扰对 ToF 测量的负面影响。</font></font></p>
           </div>
           <div class="section" id="security"><span id="sec-tof-security"></span>
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#security" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 的安全性基于这样的前提：攻击者无法猜出 ToF 运行中要使用的下一个同步字。这意味着同步字绝不能被回收。如果攻击者可以轻易猜出下一个同步字，则系统很容易受到重放攻击。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相反，使用加密连接将随机种子分发给 ToF 从属节点。该种子使用串行连接分发给 ToF 被动节点。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后将该种子输入</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/reference.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#term-aesctrdrbg"><span class="xref std std-term"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AESCTRDRBG</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">算法以生成新的同步字表。然后这些同步字用于 ToF。为了在生成新同步字表的同时优化无线电的使用，同步字列表可以进行双缓冲（取决于</font></font><code class="docutils literal notranslate"><span class="pre">tofSecCfgPrms-&gt;bUseDoubleBuffer</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），以便安全模块可以在 RF 核心使用新同步字的同时生成新同步字。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在双缓冲模式下操作时，</font></font><code class="docutils literal notranslate"><span class="pre">TOFSecurity</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块以</font></font><code class="docutils literal notranslate"><span class="pre">TOF_SEC_DBL_BUFF_SIZE</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大小为单位进行操作。双缓冲模式可减少运行突发所需的连续 RAM 量。这是推荐的操作模式。使用单缓冲模式时，缓冲区大小将是同步字的总数。</font></font></p>
            <div class="admonition note">
             <p class="first admonition-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">笔记</font></font></p>
             <p class="last"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当使用双缓冲模式（默认）时，建议将同步字总数设置为的倍数</font></font><code class="docutils literal notranslate"><span class="pre">TOF_SEC_DBL_BUFF_SIZE</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以充分利用双缓冲方案。</font></font></p>
            </div>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总之，TOF 安全模块会生成一系列伪随机同步字，不知道种子的攻击者无法猜出这些同步字。同步字会随着用于距离测量的每个</font></font><code class="docutils literal notranslate"><span class="pre">PING</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据</font></font><code class="docutils literal notranslate"><span class="pre">PONG</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包而变化。广播数据包使用恒定同步字，但不用于测量距离，因此不会影响安全性。</font></font></p>
            <div class="section" id="random-seed">
             <h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随机种子</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#random-seed" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h5>
             <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随机种子是使用真随机数生成器 (TRNG) 硬件模块和驱动程序生成的。这通过 GATT 配置文件分发给。种子长度由设置</font></font><code class="docutils literal notranslate"><span class="pre">AESCTRDRBG_SEED_LENGTH_AES_128</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
            </div>
            <div class="section" id="aesctrdrbg">
             <h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">韋斯卡特彼勒公司</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#aesctrdrbg" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h5>
             <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同步字表是使用基于 NIST SP 800-90Ar1 第 10.2.1.2 节的 AES-128 块算法生成的。这将使用 TI-Drivers</font></font><code class="docutils literal notranslate"><span class="pre">AESCTRDRBG</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">驱动程序。</font><font style="vertical-align: inherit;">有关更多信息，请参阅</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/api-reference.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#ti-driver-reference"><span class="std std-ref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">驱动程序 API 参考。</font></font></span></a><font style="vertical-align: inherit;"></font></p>
            </div>
           </div>
           <div class="section" id="tof-multinode-synchronization"><span id="sec-tof-synch"></span>
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 多节点同步</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#tof-multinode-synchronization" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如前所述，ToF 使用的同步字必须不断变化，以防止攻击者猜测它们。然而，这对被动节点来说是一个问题，它们可能会因以下原因错过飞行时间突发：</font></font></p>
            <ul class="simple">
             <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主/从错过连接事件</font></font></li>
             <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主/从机无法执行 ToF</font></font></li>
             <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被动未连接事件</font></font></li>
             <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被动未命中 ToF</font></font></li>
            </ul>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在所有情况下，被动节点即使具有安全种子也不可能确定下一个应该是哪个 SW。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过引入广播数据包，可以缓解此同步问题。当被动节点失去同步时，它将使用预先确定的恒定同步字加载其相关器并开始寻找广播数据包。恒定同步字在所有节点上都是硬编码的，并由设置</font></font><code class="docutils literal notranslate"><span class="pre">TOF_CONSTANT_SW</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 主机在 ToF 突发期间定期发送广播数据包。这些广播数据包是潜在的被动同步点 ( </font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/reference.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#term-psp"><span class="xref std std-term"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PSP</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">广播数据包的有效载荷格式在</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#sec-tof-packet-types"><span class="std std-ref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据包类型</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中描述。当被动节点收到广播数据包时，它将读取</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/reference.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#term-sctr"><span class="xref std std-term"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SCTR</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并将其与本地计数器进行比较，以确定它错过了多少</font></font><code class="docutils literal notranslate"><span class="pre">PING</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+</font></font><code class="docutils literal notranslate"><span class="pre">PONG</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交换以及它必须在其生成的同步字表中寻找多远。一旦被动节点知道它错过了多少个数据包，它就会知道下一个要监听的同步字并重新获得同步。SCTR 的完整性受 16 位</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/reference.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#term-sctr"><span class="xref std std-term"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CRC</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保护，因此被动节点可以确定它已正确收到消息。主节点负责更新 SCTR</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/reference.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#term-sctr"><span class="xref std std-term"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发送广播数据包。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下图显示了 ToF 使用的同步字表，其中 PSP/广播包定期出现：</font></font></p><img alt="../_images/ditaa-6f253ca6f5c1f1317ad584e3b233ee4d13858a7d.png" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/ditaa-6f253ca6f5c1f1317ad584e3b233ee4d13858a7d.png">
           </div>
           <div class="section" id="tof-role-switching"><span id="sec-tof-role-switching"></span>
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 角色切换</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#tof-role-switching" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本用户指南章节中讨论的 ToF 角色与 RTLSCtrl 角色无关（例如</font></font><code class="docutils literal notranslate"><span class="pre">rtls_passive</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code class="docutils literal notranslate"><span class="pre">rtls_master</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等）。这意味着 可以充当</font></font><code class="docutils literal notranslate"><span class="pre">rtls_passive</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 主设备，</font></font><code class="docutils literal notranslate"><span class="pre">rtls_master</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以充当 ToF 被动设备。这个概念称为角色切换。角色切换通过空间分集提高了系统的稳健性。由于多路径反射，空间分集非常重要。如果某个节点当前被指定为 ToF 主设备，但无法测量直接路径，则会发生角色切换并指定一个新节点为主设备。新主设备位于不同的位置，有机会通过直接路径从</font></font><code class="docutils literal notranslate"><span class="pre">PONG</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接收</font></font><code class="docutils literal notranslate"><span class="pre">rtls_slave</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">角色切换是通过 RTLSCtrl 命令实现的。有关该命令的更多信息，请参阅</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#sec-tof-rtls-ctrl"><span class="std std-ref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">飞行时间的 RTLSCtrl</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。建议监控每个 ToF 节点的统计数据（例如，okay 样本的数量），并将结果最好的节点指定为下一次突发的 ToF 主节点。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">角色切换无法在 ToF 突发期间执行，因此必须在调用之间进行协调</font></font><code class="docutils literal notranslate"><span class="pre">TOF_run(...)</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。如果在突发期间发送命令，它将在下一次突发中生效。</font></font></p>
           </div>
          </div>
          <div class="section" id="tof-driver"><span id="sec-tof-driver"></span>
           <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 驱动器</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#tof-driver" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 驱动程序负责管理飞行时间 RF 命令的设置，以及 RF 驱动程序与应用程序之间的接口。此外，ToF 驱动程序将使用 ToF 安全模块生成随机种子。此外，ToF 安全模块将使用随机种子通过高级加密标准计数器确定性随机位生成器 ( </font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/reference.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#term-aesctrdrbg"><span class="xref std std-term"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AESCTRDRBG</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 算法生成安全同步字。</font></font></p>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从申请上来说，比较简单。你需要：</font></font></p>
           <ol class="arabic simple">
            <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始化</font></font></li>
            <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">校准</font></font></li>
            <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">跑步</font></font></li>
            <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收集结果</font></font></li>
           </ol>
           <div class="section" id="initialize">
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始化</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#initialize" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 驱动程序需要一个填充了一些信息的参数结构。示例已经填充了这些信息，但最有趣的参数是：</font></font></p>
            <ul class="simple">
             <li><code class="docutils literal notranslate"><span class="pre">tofRole</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 设备角色：主/从</font></font></li>
             <li><code class="docutils literal notranslate"><span class="pre">pT1RSSIBuf</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 指向样本缓冲区的指针</font></font></li>
             <li><code class="docutils literal notranslate"><span class="pre">numSyncwordsPerBurst</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 同步字的数量</font></font></li>
             <li><code class="docutils literal notranslate"><span class="pre">pFrequencies</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 指向频率数组的指针</font></font></li>
             <li><code class="docutils literal notranslate"><span class="pre">numFreq</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 频率数量</font></font></li>
             <li><code class="docutils literal notranslate"><span class="pre">pfnTofApplicationCB</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 运行后回调</font></font></li>
             <li><code class="docutils literal notranslate"><span class="pre">tofSecurityParams</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 安全配置参数</font></font></li>
             <li><code class="docutils literal notranslate"><span class="pre">freqChangePeriod</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 我们应该多久改变一次频率？</font></font></li>
             <li><code class="docutils literal notranslate"><span class="pre">syncTimeout</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 等待第一个同步字需要多长时间</font></font></li>
             <li><code class="docutils literal notranslate"><span class="pre">pfnTofApplicationCB</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 回调应用程序</font></font></li>
             <li><code class="docutils literal notranslate"><span class="pre">slaveLqiFilter</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 自动过滤 ToF 从属角色</font></font></li>
             <li><code class="docutils literal notranslate"><span class="pre">postProcessLqiThresh</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 用于片上后处理的 LQI 阈值</font></font></li>
             <li><code class="docutils literal notranslate"><span class="pre">postProcessMagnRatio</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 用于片上后处理的幅度无线电阈值</font></font></li>
            </ul>
            <p><font style="vertical-align: inherit;"></font><cite><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 驱动程序由RTLSCtrl</font></font></cite><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块管理</font><font style="vertical-align: inherit;">，但这里解释了其参数和行为以帮助理解。</font></font></p>
           </div>
           <div class="section" id="run">
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">跑步</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#run" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当您调用时，</font><font style="vertical-align: inherit;">它将立即启动。与蓝牙结合使用时，您将从 BLE 堆栈中获取以无线接入定时器 (RAT) 为单位的时间，以用作 ToF 结束时间。</font></font><code class="docutils literal notranslate"><span class="pre">TOF_run(handle,</span> <span class="pre">tofEndTime)</span></code><font style="vertical-align: inherit;"></font></p>
            <div class="admonition note">
             <p class="first admonition-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">笔记</font></font></p>
             <p class="last"><cite><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tofEndTime</font></font></cite><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以 4 MHz 运行的无线接入定时器 (RAT) 的刻度来测量。请务必记住，这与用于测量 ToF 的 8 MHz 运行的 RF 核心定时器不同。</font></font></p>
            </div>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在蓝牙等堆栈通信之间安排 ToF 事件时，</font></font><cite><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tofEndTime</font></font></cite><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数很有价值。</font></font></p>
           </div>
           <div class="section" id="collect-the-results">
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收集结果</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#collect-the-results" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是在初始化参数给出的回调函数中完成的：</font></font></p>
            <div class="highlight-c notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">ToF_BurstStat</span> <span class="n">tofBurstResults</span><span class="p">[</span><span class="n">TOF_MAX_NUM_FREQ</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>

<span class="kt">void</span> <span class="nf">myCallback</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">status</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">TOF_getBurstStat</span><span class="p">(</span><span class="n">tofHandle</span><span class="p">,</span> <span class="n">tofBurstResults</span><span class="p">);</span>
  <span class="c1">// Do something</span>
<span class="p">}</span>
</pre>
             </div>
            </div>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此函数获取交错的原始样本并按频率计算平均值。</font></font></p><img alt="../_images/aafi-c9ed0ec0f354c17d2564711fb759ac03879558ab.png" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/aafig-c9ed0ec0f354c17d2564711fb759ac03879558ab.png">
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">原始样本存储在一个平面列表中（见上文），但统计功能按频率显示它们：</font></font></p>
            <div class="highlight-c notranslate">
             <div class="highlight">
              <pre><span></span><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
    <span class="kt">uint16_t</span> <span class="n">freq</span><span class="p">;</span>          <span class="c1">// Frequency</span>
    <span class="kt">double</span>   <span class="n">tick</span><span class="p">;</span>          <span class="c1">// Time of Flight in clock ticks, averaged over all valid samples for `freq`</span>
    <span class="kt">double</span>   <span class="n">tickVariance</span><span class="p">;</span>  <span class="c1">// Variance of the tick values</span>
    <span class="kt">uint32_t</span> <span class="n">numOk</span><span class="p">;</span>         <span class="c1">// Number of packets received OK for `freq`</span>
<span class="p">}</span> <span class="n">ToF_BurstStat</span><span class="p">;</span>
</pre>
             </div>
            </div>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过减去 0 米处的校准刻度值并乘以 ，即可将刻度值转换为米</font></font><code class="docutils literal notranslate"><span class="pre">18.75</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
           </div>
           <div class="section" id="calibrate"><span id="sec-tof-calib"></span>
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">校准</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#calibrate" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测量的飞行时间将比实际的飞行时间更长。测量中的误差是由以下量引起的：</font></font></p>
            <blockquote>
             <div>
              <ul class="simple">
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从机周转时间（从 RX 切换到 TX）</font></font></li>
               <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 ToF PHY 时设备的固有延迟</font></font></li>
              </ul>
             </div>
            </blockquote>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些量是确定性的和非零的。根据硅片的特性，它们在不同的器件之间略有不同。这些特性在器件的整个使用寿命期间都不会改变，因此每个器件只需进行一次校准，并且可以存储。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主控上的 ToF 测量由以下组件组成：</font></font></p>
            <div class="math">
             <p><img src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/50bfba70768e669e36d569a33f04e178057cee50.svg" alt="\begin{align*} \begin{split} \text{$Master_{time}$} &amp;= TOF_{主-从} + \text{从属周转时间} + \text{$TOF_{从-主}$}\\ &amp;+ \text{$time_{SW\ from\ 从属}$} + \text{主固有延迟} + \text{从属固有延迟} \end{split} \end{align*}"></p>
            </div>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下组件构成了被动式 ToF 测量：</font></font></p>
            <div class="math">
             <p><img src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/8bde485f70708cadb772086c3ea63a8f05efcc89.svg" alt="\begin{align*} \begin{split} \text{$Passive_{time}$} &amp;= TOF_{主-被动} + \text{$time_{payload\ from\ master}$} + \text{从属\ turnaround\ time}\\ &amp;+ \text{$TOF_{从属-被动}$}+ \text{$time_{SW\ from\ slave}$} + \text{passive\ inner delay} + \text{从属\ inner\ delay} \end{split} \end{align*}"></p>
            </div>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为主设备，每个 ToF 测量包含两个应校准的延迟组件，即每个设备的固有延迟以及从设备的周转时间。假设系统由三个设备组成，主设备可以轮换以产生以下结果，其中 M_12 表示设备 1 为主设备、设备 2 为从设备时测量的 ToF。请注意，下面假设 ToF=0</font></font></p>
            <div class="math">
             <p><img src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/ce93dc2f749005651e63ba7994ea6ad5968fcff3.svg" alt="\begin{align*} \begin{split} M_{12} = D_{1} + D_{2}\\ M_{23} = D_{2} + D_{3}\\ M_{31} = D_{3} + D_{1}\\ \end{split} \end{align*}"></p>
            </div>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">求解这些方程可得出以下结果：</font></font></p>
            <div class="math">
             <p><img src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/fd63bf99f0d5d7f0bd9a9820cf54932f1fe2c2cf.svg" alt="\begin{align*} \begin{split} 2 \times D_{1} = M_{12} + M_{31} - M_{23}\\ 2 \times D_{2} = M_{12} + M_{23} - M_{12}\\ 2 \times D_{3} = M_{13} + M_{23} - M_{13}\\ \end{split} \end{align*}"></p>
            </div>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">求解上述方程组可以得出每个设备作为主设备运行时的固有延迟。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于被动设备，也可以这样做，但要记住被动测量包含所有三个设备（主设备、从设备、被动设备）的延迟。例如，ToF=0。在以下等式中，使用以下约定。P_123 表示被动 ToF 测量，其中设备 1 是被动设备，设备 2 是主设备，设备 3 是从设备。我们将在计算被动延迟时引入第 4 个设备，以展示随着被动设备的添加，系统如何扩展。</font></font></p>
            <div class="math">
             <p><img src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/fa27533c96d45b28ff76d55839ea657fe966eb9b.svg" alt="\begin{align*} P_{123} = D_{1} + D_{2} + D_{3} \end{align*}"></p>
            </div>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在整个设备中轮换被动角色可得出以下方程组，请注意，这里我们假设有 4 个被动设备。随着更多设备的添加，下面的方法可以扩展。</font></font></p>
            <div class="math">
             <p><img src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/e7abdd83932060de0a162ddda3c3e5e4f5667a13.svg" alt="\begin{align*} \begin{split} D_{p1} = P_{123} + D_{2} - D_{3}\\ D_{p2} = P_{124} + D_{2} - D_{4}\\ D_{p3} = M_{134} + D_{3} - D_{4}\\ \end{split} \end{align*}"></p>
            </div>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解此方程可得：</font></font></p>
            <div class="math">
             <p><img src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/1c0215513bb8fd53309574195a71f1395b7d84c7.svg" alt="\begin{align*} \begin{split} 3 \times D_{p1} = P_{123} + P_{124} + P_{134} - 2 \times D_{2} - 2 \times D_{3} - 2 \times D_{4}\\ \end{split} \end{align*}"></p>
            </div>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了表征设备，应在生产时在受控环境中测量这些延迟，并将其存储在非易失性存储器中，以便可以使用它们来调整所有 ToF 测量。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总之，ToF 校准将产生一个刻度值矢量，对于给定的 ToF 角色，该矢量应在每个频率上在已知距离处出现。</font></font></p>
           </div>
           <div class="section" id="application">
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#application" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序必须以某种方式与对等设备商定应使用的频率、频率的顺序以及同步字列表应包含的内容。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此外，它必须</font></font><code class="docutils literal notranslate"><span class="pre">ToF_run(...)</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在适当的时间调用来初始化初始同步字搜索和时隙测量突发。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这也可以显示为（非常）简化的序列图。请注意，下图未显示任何广播消息，但它们将定期插入：</font></font></p>
            <div class="figure" id="id32">
             <p class="plantuml"><img src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/plantuml-60643ea243763a1202f7dfd0d4262f0d7bd9e57a.png" alt="@startuml 参与者 BLEStack 作为堆栈参与者 应用程序作为应用程序参与者 ToF_driver 作为 drv 参与者 ToFSecurity 作为 sec 参与者 RF_driver 作为 rf 参与者 Radio 作为 radio 参与者 TRNG 作为 trng 参与者 AESCTRDRBG 作为 drbg 参与者 CryptoKeyPlaintext 作为加密 激活应用程序 app -&gt; app : Initialize\nToF_Params app -&gt; drv : ToF_open(..) 激活 drv drv -&gt; drv : 初始化 drv -&gt; rf : RF_open(..) drv -&gt; sec : TOFSecurity_open(...) sec -&gt; trng : TRNGCC26XX_getNumber(...) sec -&gt; drbg : AESCTRDRBG_open(...) drv -&gt; drv : TOF_genSyncwordBatches(...) app -&gt; drv: TOF_genSyncWords(...) drv -&gt; sec: TOFSecurity_genSyncWords(...) sec -&gt; crypto : CryptoKeyPlaintext_initKey(...) sec -&gt; drbg : AESCTRDRBG_getBytes(...) drv -&gt; app : ToF_Handle 停用 drv 停用 app ... stack -&gt; app : BLE-stack\n 连接已建立 激活 app app -&gt; drv : ToF_GetSeed(...) 激活 sec sec -&gt; drv : seed[AESCTRDRBG_SEED_LENGTH_AES_128] 停用 sec 停用 app 停用 trng == 通过加密的 BLE-Stack 连接将随机种子发送到 ToF Slave \n== 激活 stack stack -&gt; app : BLE-stack\n 连接事件已结束 停用 stack 激活 drv app -&gt; drv : ToF_run(freqs, ...) 激活 drv drv -&gt; rf : RF_schedCmd 停用 drv 激活rf rf -&gt; radio : 加载补丁 激活无线电 rf -&gt; radio : 运行命令 radio -&gt; radio : 搜索\nsync radio --&gt; : SW&lt;sub&gt;0&lt;/sub&gt; radio &lt;-- : SW&lt;sub&gt;1&lt;/sub&gt; radio -&gt; radio : 循环\n并存储时间戳 激活无线电 radio -&gt; rf : 中断 停用无线电 alt RF_EventRxOk rf -&gt; drv : RF_Callback(RF_EventRxOk) drv -&gt; drv: 更新 SCTR，设置下一条广播消息 drv -&gt; drv: TOF_genSyncwordBatches(...) drv -&gt; drv: TOF_genSyncWords(...) drv -&gt; sec: TOFSecurity_genSyncWords(...) sec -&gt; crypto : CryptoKeyPlaintext_initKey(...) sec -&gt; drbg : AESCTRDRBG_getBytes(...) drv -&gt; app :回调否则 RF_EventDoubleSyncWordBufferSwitch rf -&gt; drv : RF_Callback(RF_EventDoubleSyncWordBufferSwitch) drv -&gt; drv: TOF_genSyncwordBatches(...) drv -&gt; drv: TOF_genSyncWords(...) drv -&gt; sec: TOFSecurity_genSyncWords(...) sec -&gt; crypto : CryptoKeyPlaintext_initKey(...) sec -&gt; drbg : AESCTRDRBG_getBytes(...) drv -&gt; radio: 新的同步字缓冲区就绪否则 RF_EventRxNOk rf -&gt; drv : RF_Callback(RF_EventRxNOk) alt 如果被动 drv -&gt; drv: TOF_handleOutOfSync end drv -&gt; drv: TOF_genSyncwordBatches(...) drv -&gt; drv: TOF_genSyncWords(...) drv -&gt; sec: TOFSecurity_genSyncWords(...) sec -&gt; crypto : CryptoKeyPlaintext_initKey(...) sec -&gt; drbg : AESCTRDRBG_getBytes(...) end deactivate rf == 在应用程序中 CB == 激活应用程序 app -&gt; drv : ToF_getBurstStats(..) drv -&gt; drv : 从时间戳计算统计数据 drv -&gt; app : ToF_BurstStats app -&gt; app : 平均一点 [&lt;- app : 显示@enduml"></p>
             <p class="caption"><span class="caption-number"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 81. </font></font></span><span class="caption-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 应用示例</font></font></span><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#id32" title="此图片的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></p>
            </div>
           </div>
           <div class="section" id="debug-statistics"><span id="sec-tof-debug-stat"></span>
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试统计</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#debug-statistics" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 驱动程序包含一项功能，可以跟踪多个 ToF 测量的统计数据。这些统计数据存储在全局结构 ( </font></font><code class="docutils literal notranslate"><span class="pre">gTofStatistics</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) 中，可以将其添加到 IDE 中的调试实时观察视图中。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过抛出定义可以启用统计跟踪</font></font><code class="docutils literal notranslate"><span class="pre">RTLS_TOF_DEBUG</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
           </div>
          </div>
          <div class="section" id="rtlsctrl-for-time-of-flight"><span id="sec-tof-rtls-ctrl"></span>
           <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLSCtrl 用于飞行时间</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#rtlsctrl-for-time-of-flight" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本指南前面的部分描述了飞行时间的理论、其射频核心功能以及其低级驱动程序和安全模块。</font></font></p>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节旨在描述通过 RTLSCtrl 接口公开的与飞行时间相关的远程过程调用和参数。请参阅</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#sec-rtls-sw-architecture"><span class="std std-ref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通用 RTLS 软件架构，</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了解 RTLSCtrl 如何融入 TI RTLS 软件架构。</font></font></p>
           <div class="section" id="tof-parameters">
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 参数</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#tof-parameters" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 的行为通过</font></font><code class="docutils literal notranslate"><span class="pre">RTLS_CMD_TOF_SET_PARAMS</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNPI 请求中设置的 RTLS python 环境参数进行控制。此请求将发送到主节点和被动节点。主节点将通过 BLE 将选定的 ToF 设置转发给从节点。</font></font><code class="docutils literal notranslate"><span class="pre">RTLS_CMD_TOF_SET_PARAMS</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须在运行 ToF 之前调用。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参阅</font></font><code class="docutils literal notranslate"><span class="pre">rtlsTofParams_t</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以了解更多信息。</font></font></p>
            <div class="section" id="tof-result-mode">
             <h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 结果模式</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#tof-result-mode" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h5>
             <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以配置 RTLS 节点通过以下方式报告 ToF 样本数据：</font></font></p>
             <div class="wy-table-responsive"><table border="1" class="docutils">
              <colgroup>
               <col width="23%">
               <col width="38%">
               <col width="23%">
               <col width="16%">
              </colgroup>
              <thead valign="bottom">
               <tr class="row-odd">
                <th class="head"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 结果模式</font></font></th>
                <th class="head"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概括</font></font></th>
                <th class="head"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串行帧数/突发</font></font></th>
                <th class="head"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷信息</font></font></th>
               </tr>
              </thead>
              <tbody valign="top">
               <tr class="row-even">
                <td><code class="docutils literal notranslate"><span class="pre">RTLS_CMD_TOF_RESULT_DIST</span></code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供突发中所有频率的单一距离估计以及所有突发的移动平均值</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></td>
                <td>
                 <ul class="first last simple">
                  <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">距离</font></font></li>
                  <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RSSI</font></font></li>
                 </ul></td>
               </tr>
               <tr class="row-odd">
                <td><code class="docutils literal notranslate"><span class="pre">RTLS_CMD_TOF_RESULT_STAT</span></code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供每个频率的刻度平均值和方差</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个使用频率 1 个</font></font></td>
                <td>
                 <ul class="first last simple">
                  <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">频率</font></font></li>
                  <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打钩</font></font></li>
                  <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tickVariance</font></font></li>
                  <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RSSI</font></font></li>
                  <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定数字</font></font></li>
                 </ul></td>
               </tr>
               <tr class="row-even">
                <td><code class="docutils literal notranslate"><span class="pre">RTLS_CMD_TOF_RESULT_RAW</span></code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接从 RF 核心提供突发内的每个滴答样本。</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每突发同步字数/2</font></font></td>
                <td>
                 <ul class="first last simple">
                  <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打钩</font></font></li>
                  <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">频率指数</font></font></li>
                  <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RSSI</font></font></li>
                 </ul></td>
               </tr>
              </tbody>
             </table></div>
             <p><font style="vertical-align: inherit;"></font><code class="docutils literal notranslate"><span class="pre">resultMode</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 模式可通过字段</font><font style="vertical-align: inherit;">进行控制</font></font><code class="docutils literal notranslate"><span class="pre">RTLS_CMD_TOF_SET_PARAMS</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。表格下方的结果模式为 PC 提供更多数据，但也要求嵌入式设备更频繁地发送 UNPI 帧并使用更多 RAM。</font></font></p>
             <div class="admonition attention">
              <p class="first admonition-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意力</font></font></p>
              <p class="last"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">建议使用最详细模式在 PC 上对 ToF 算法进行原型设计，然后通过平衡节点管理器和嵌入式设备之间的处理来降低发送数据的频率。</font></font></p>
             </div>
            </div>
            <div class="section" id="tof-run-mode">
             <h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF运行模式</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#tof-run-mode" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h5>
             <p><code class="docutils literal notranslate"><span class="pre">runMode</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个参数</font></font><code class="docutils literal notranslate"><span class="pre">RTLS_CMD_TOF_SET_PARAMS</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，描述了触发 ToF 测量的因素以及 ToF 测量的运行频率。</font></font></p>
             <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择运行模式时，考虑功率预算非常重要。连续运行 ToF 有利于在 PC 端对算法进行原型设计，因为可以提供大量数据，但对于电池供电操作来说效率不高。建议根据 RSSI 触发 ToF，并且仅运行以收集实现给定置信区间所需的最少样本数。</font></font></p>
             <div class="wy-table-responsive"><table border="1" class="docutils">
              <colgroup>
               <col width="27%">
               <col width="73%">
              </colgroup>
              <thead valign="bottom">
               <tr class="row-odd">
                <th class="head"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 模式</font></font></th>
                <th class="head"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概括</font></font></th>
               </tr>
              </thead>
              <tbody valign="top">
               <tr class="row-even">
                <td><code class="docutils literal notranslate"><span class="pre">TOF_MODE_CONT</span></code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 将持续运行，直到</font></font><code class="docutils literal notranslate"><span class="pre">RTLS_CMD_TOF_ENABLE</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 stop 参数调用</font></font></td>
               </tr>
               <tr class="row-odd">
                <td><code class="docutils literal notranslate"><span class="pre">TOF_MODE_AUTO</span></code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 根据从设备的 RSSI 自动触发。在连接事件期间测量 RSSI，阈值</font></font><code class="docutils literal notranslate"><span class="pre">autoTofRssiThresh</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由</font></font><code class="docutils literal notranslate"><span class="pre">RTLS_CMD_TOF_SET_PARAMS</span></code></td>
               </tr>
              </tbody>
             </table></div>
            </div>
            <div class="section" id="syncwords-per-burst">
             <h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每突发同步字数</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#syncwords-per-burst" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h5>
             <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该命令中另一个值得关注的参数</font></font><code class="docutils literal notranslate"><span class="pre">RTLS_CMD_TOF_SET_PARAMS</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是样本数量。表示</font><font style="vertical-align: inherit;">每个 ToF 突发使用</font></font><code class="docutils literal notranslate"><span class="pre">numSyncwordsPerBurst</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多少个</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同步字</font></font></strong><font style="vertical-align: inherit;"></font><code class="docutils literal notranslate"><span class="pre">PING</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。需要两个同步字才能创建一个 ToF 样本 ( + </font></font><code class="docutils literal notranslate"><span class="pre">PONG</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)。这得出以下等式：</font></font></p>
             <div class="highlight-c notranslate">
              <div class="highlight">
               <pre><span></span><span class="n">NumTickMeasurements</span> <span class="o">=</span> <span class="n">numSyncwordsPerBurst</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">numPSPs</span>
</pre>
              </div>
             </div>
             <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">换句话说，每个飞行时间突发执行的刻度测量数是参数的一半减去</font><font style="vertical-align: inherit;">突发中包含的</font></font><code class="docutils literal notranslate"><span class="pre">numSyncwordsPerBurst</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何被动同步点 ( </font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/reference.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#term-psp"><span class="xref std std-term"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PSP )。PSP 的周期由 ToF 命令的广播结构中的字段定义。默认情况下，来自</font></font></span></a><font style="vertical-align: inherit;"><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/reference.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#term-aesctrdrbg"><span class="xref std std-term"><font style="vertical-align: inherit;">AESCTRDRBG</font></span></a></font><code class="docutils literal notranslate"><span class="pre">RF_cmdTof.BC</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的每批同步字都有一个 PSP </font><font style="vertical-align: inherit;">。（由设置</font><font style="vertical-align: inherit;">）</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/reference.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#term-aesctrdrbg"><span class="xref std std-term"><font style="vertical-align: inherit;"></font></span></a><font style="vertical-align: inherit;"></font><code class="docutils literal notranslate"><span class="pre">gTofSecHandle.numOfSyncWordsPerBuffer</span></code><font style="vertical-align: inherit;"></font></p>
             <div class="admonition note">
              <p class="first admonition-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">笔记</font></font></p>
              <p class="last"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请记住，并非所有 ToF 模式都会报告每个样本的原始刻度值。这意味着在增加时，您可能不会观察到发送到 PC 的更多数据</font></font><code class="docutils literal notranslate"><span class="pre">numSamples</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。这是因为在</font></font><code class="docutils literal notranslate"><span class="pre">RTLS_CMD_TOF_RESULT_DIST</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和等模式下，</font></font><code class="docutils literal notranslate"><span class="pre">RTLS_CMD_TOF_RESULT_STAT</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设备上会对样本进行一些预处理。</font></font></p>
             </div>
            </div>
            <div class="section" id="frequencies">
             <h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">频率</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#frequencies" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h5>
             <p><code class="docutils literal notranslate"><span class="pre">RTLS_CMD_TOF_SET_PARAMS</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还采用频率列表和频率数量。频率列表中的每个条目对应于应在其上执行飞行时间的通道。为 ToF 选择的频率具有多样性非常重要，因为</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/reference.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#term-multi-path-fading"><span class="xref std std-term"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多径衰落</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等物理因素是频率选择性的。</font></font></p>
             <blockquote>
              <div>
               <ul class="simple">
                <li><code class="docutils literal notranslate"><span class="pre">frequencies</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是用于 ToF 的 BLE 通道频率列表（以 MHz 为单位）</font></font></li>
                <li><code class="docutils literal notranslate"><span class="pre">numFreq</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是此列表中的频道数量</font></font></li>
               </ul>
              </div>
             </blockquote>
             <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BLE 信道间隔 2 MHz，范围从 [2402, 2480]（含）。虽然 ToF 不直接使用 BLE 物理数据包格式，但它使用相同的信道图。此范围内的频率是可接受的 ToF 参数。信道由其载波频率指定。</font></font></p>
             <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用以下代码在 Python 中初始化频率列表：</font></font></p>
             <div class="highlight-python notranslate">
              <div class="highlight">
               <pre><span></span><span class="n">tofFreqList</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2408</span><span class="p">,</span> <span class="mi">2412</span><span class="p">,</span> <span class="mi">2418</span><span class="p">,</span> <span class="mi">2424</span><span class="p">]</span> <span class="c1">#Other options: 2414, 2420</span>
<span class="n">tofNumFreq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tofFreqList</span><span class="p">)</span>
</pre>
              </div>
             </div>
            </div>
            <div class="section" id="lqi-filters">
             <h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LQI 过滤器</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#lqi-filters" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h5>
             <p><font style="vertical-align: inherit;"></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#sec-tof-lqi-and-filtering"><span class="std std-ref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如在链路质量指示 (LQI) 和多路径过滤</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中所述</font><font style="vertical-align: inherit;">，有两个可配置的 LQI 过滤器值分别影响主/被动和从属 LQI 处理。请参阅下表了解每个参数及其使用说明：</font></font></p>
             <div class="wy-table-responsive"><table border="1" class="docutils">
              <colgroup>
               <col width="20%">
               <col width="74%">
               <col width="6%">
              </colgroup>
              <tbody valign="top">
               <tr class="row-odd">
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTLSCtrl 参数</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></td>
               </tr>
               <tr class="row-even">
                <td><code class="docutils literal notranslate"><span class="pre">slaveLqiFilter</span></code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果从站收到 LQI 大于此阈值的 PING，它将不会响应</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0-255</font></font></td>
               </tr>
               <tr class="row-odd">
                <td><code class="docutils literal notranslate"><span class="pre">postProcessLqiThresh</span></code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果主机或被动设备收到的 LQI 大于此值的测量值，则会被丢弃</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0-255</font></font></td>
               </tr>
              </tbody>
             </table></div>
            </div>
            <div class="section" id="magnitude-ratio-filter">
             <h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">幅度比率滤波器</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#magnitude-ratio-filter" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h5>
             <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多路径干扰的另一个特征是 &lt;&lt;1&gt;&gt; 和 &lt;&lt;0&gt;&gt; 符号的 RSSI 之间存在差异。RF 核心将报告 &lt;&lt;1&gt;&gt; 和 &lt;&lt;0&gt;&gt; 符号的幅度作为 ToF 结果的一部分，并将结果在 中进行后处理。</font><font style="vertical-align: inherit;">和</font></font><code class="docutils literal notranslate"><span class="pre">TOF_getBurstStat()</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的比率</font><font style="vertical-align: inherit;">将计算为浮点双精度数。如果任一比率大于</font><cite><font style="vertical-align: inherit;">postProcessMagnRatio/100.0，</font></cite><font style="vertical-align: inherit;">则结果将被丢弃。</font></font><code class="docutils literal notranslate"><span class="pre">sym1/sym0</span></code><font style="vertical-align: inherit;"></font><code class="docutils literal notranslate"><span class="pre">sym0/sym1</span></code><font style="vertical-align: inherit;"></font><cite><font style="vertical-align: inherit;"></font></cite><font style="vertical-align: inherit;"></font></p>
            </div>
           </div>
           <div class="section" id="role-switch">
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">角色转换</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#role-switch" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#sec-tof-role-switching"><span class="std std-ref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToF 角色切换</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中介绍了角色切换的好处及其理论</font><font style="vertical-align: inherit;">。本节介绍实现角色切换的 RTLSCtrl，即</font></font><code class="docutils literal notranslate"><span class="pre">RTLS_CMD_TOF_SWITCH_ROLE</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。该命令采用单个 8 位参数，该参数是新角色的枚举。如前所述，它仅在将角色从主设备切换到被动设备以及从被动设备切换到主设备时有效。角色切换可以独立于设置 ToF 参数进行。角色切换命令将对状态变化进行验证，然后进行</font></font><code class="docutils literal notranslate"><span class="pre">RF_cmdTof.bMaster</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相应设置。请注意，角色切换不能在 ToF 突发内发生，并且必须在突发之间在主设备和被动设备之间进行协调。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效的 ToF 角色在 中定义</font></font><code class="docutils literal notranslate"><span class="pre">TOF.h::ToF_Role</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
           </div>
           <div class="section" id="calibration">
            <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">校准</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#calibration" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h4>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#sec-tof-calib"><span class="std std-ref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">校准</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中所述，ToF 的校准向量必须由以下内容组成：角色、频率、距离和刻度平均值。校准是一种测量和存储给定频率、角色和距离的刻度平均值的方法。所有频率都按照</font></font><code class="docutils literal notranslate"><span class="pre">calibDistance</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令参数设置的相同距离进行校准。校准过程包括在足够多的运行中取移动平均值，以产生</font><font style="vertical-align: inherit;">命令参数</font></font><code class="docutils literal notranslate"><span class="pre">RTLS_CMD_TOF_CALIBRATE</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定的每个频率的样本数。</font></font><code class="docutils literal notranslate"><span class="pre">samplesPerFreq</span></code><font style="vertical-align: inherit;"></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该命令具有以下请求和响应类型：</font></font></p>
            <blockquote>
             <div>
              <ul class="simple">
               <li><code class="docutils literal notranslate"><span class="pre">SyncReq</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：向节点发送请求以开始校准</font></font></li>
               <li><code class="docutils literal notranslate"><span class="pre">SyncRsp</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：验证参数并开始校准时，返回状态</font></font></li>
               <li><code class="docutils literal notranslate"><span class="pre">AsyncRsp</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：一旦</font></font><code class="docutils literal notranslate"><span class="pre">samplesPerFreq</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为每个频率存储了校准向量，就返回该校准向量。</font></font></li>
              </ul>
             </div>
            </blockquote>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">校准命令的行为如下：</font></font></p>
            <blockquote>
             <div>
              <ul class="simple">
               <li><code class="docutils literal notranslate"><span class="pre">useCalibFromNV</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">== 真且 NV 中存在校准，无操作，立即返回</font></font></li>
               <li><code class="docutils literal notranslate"><span class="pre">useCalibFromNV</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">== 真且 NV 中不存在校准，开始校准，对 ToF 突发执行移动平均，直到</font></font><code class="docutils literal notranslate"><span class="pre">samplesPerFreq</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">达到。存储结果并</font></font><code class="docutils literal notranslate"><span class="pre">calibDistance</span></code></li>
               <li><code class="docutils literal notranslate"><span class="pre">useCalibFromNV</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">== False 则无论 NV 中是否存在都会进行校准。结果将存储在 NV 中。</font></font></li>
              </ul>
             </div>
            </blockquote>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">校准命令遵循</font></font><a class="reference internal" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-common/flash_memory-cc2640.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#using-simple-nv"><span class="std std-ref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用简单 NV 进行闪存存储</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。它将使用 OSAL SNV 来存储校准。这是因为 OSAL SNV 实现了 EEPROM 仿真并允许在不擦除整个页面的情况下覆盖校准，这是一个额外的好处。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TOF 校准使用的 NVID 开始于</font></font><code class="docutils literal notranslate"><span class="pre">BLE_NVID_CUST_START</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并使用以下数量的 NVID：</font></font><code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">+</span> <span class="pre">(calibParams.numFreq</span> <span class="pre">/</span> <span class="pre">RTLS_TOF_FREQ_PER_NV_BLOCK)</span> <span class="pre">+</span> <span class="pre">(calibParams.numFreq</span>&nbsp; <span class="pre">%</span> <span class="pre">RTLS_TOF_FREQ_PER_NV_BLOCK)</span></code></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">校准过程将使用第一个 NVID 来存储有关校准的元数据，包括频率列表和校准距离。以下 NVID 用于存储</font></font><code class="docutils literal notranslate"><span class="pre">ToF_BurstStat</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">校准期间计算的每个频率的移动平均值。</font></font></p>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用 读取校准向量</font></font><code class="docutils literal notranslate"><span class="pre">RTLS_CMD_TOF_CALIB_NV_READ</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
            <blockquote>
             <div>
              <div class="admonition warning">
               <p class="first admonition-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告</font></font></p>
               <p class="last"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">校准取决于角色、频率列表和设备。这意味着如果 ToF 频率列表、角色或设备发生变化，则必须重新进行校准。</font></font></p>
              </div>
             </div>
            </blockquote>
            <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目前，校准结果仅在 时使用</font></font><code class="docutils literal notranslate"><span class="pre">TOF_MODE_DIST</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但相同的概念（对 Tick 值取平均值以建立已知距离的参考点）适用于所有操作模式。在 RAW 或 STAT 模式下，应计算校准并将其存储在 PC 上。</font></font></p>
           </div>
          </div>
          <div class="section" id="interleaving-with-bluetooth">
           <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与蓝牙交错</font></font><a class="headerlink" href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp#interleaving-with-bluetooth" title="此标题的永久链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处于连接状态的蓝牙 LE 设备必然会在特定时间（称为 ）被唤醒并发送或接收数据</font><font style="vertical-align: inherit;">。此类事件之间的间隔称为</font><font style="vertical-align: inherit;">。</font></font><code class="docutils literal notranslate"><span class="pre">Connection</span> <span class="pre">Events</span></code><font style="vertical-align: inherit;"></font><code class="docutils literal notranslate"><span class="pre">Connection</span> <span class="pre">Interval</span></code><font style="vertical-align: inherit;"></font></p>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code class="docutils literal notranslate"><span class="pre">Passive</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设备集成了连接监视器功能，因此它可以获取连接信息（rssi、时间戳）并且在每个连接事件结束时监听 ToF 数据包并提供计算距离。</font></font></p><img alt="../_images/ditaa-ba8e1bb8cade777ce1d6e45d49ed954d12e43ad6.png" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/ditaa-ba8e1bb8cade777ce1d6e45d49ed954d12e43ad6.png">
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在一个连接事件结束和下一个预定的连接事件开始之间的时间内，有时间安排其他 RF 命令，例如 ToF。</font></font></p>
           <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可用时间可能会有所不同，但在连接事件完成回调中会提供时间戳，表示何时必须使用无线电完成飞行时间。</font></font></p>
          </div>
         </div>
        </div>
       </div>
      </div>
      <footer>
       <div class="rst-footer-buttons" role="navigation" aria-label="页脚导航"><a href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/u-stack-index.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp" class="btn btn-neutral float-right" title="微型 BLE 堆栈" accesskey="n"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一个</font></font><span class="fa fa-arrow-circle-right"></span></a> <a href="https://software--dl-ti-com.translate.goog/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x/custom-hardware.html?_x_tr_sl=auto&amp;_x_tr_tl=zh-CN&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp" class="btn btn-neutral" title="TI 提供的电路板文件" accesskey="p"><span class="fa fa-arrow-circle-left"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以前的</font></font></a>
       </div>
       <hr>
       <div role="contentinfo">
        <p><a href="https://translate.google.com/website?sl=auto&amp;tl=zh-CN&amp;hl=en&amp;client=webapp&amp;u=https://www.ti.com/corp/docs/legal/copyright.shtml"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2010-2019，德州仪器</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，德州仪器公司。保留所有权利。</font></font><br><a href="https://translate.google.com/website?sl=auto&amp;tl=zh-CN&amp;hl=en&amp;client=webapp&amp;u=https://www.ti.com/corp/docs/legal/trademark/trademrk.htm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">商标</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font><a href="https://translate.google.com/website?sl=auto&amp;tl=zh-CN&amp;hl=en&amp;client=webapp&amp;u=https://www.ti.com/corp/docs/legal/privacy.shtml"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">隐私政策</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font><a href="https://translate.google.com/website?sl=auto&amp;tl=zh-CN&amp;hl=en&amp;client=webapp&amp;u=https://www.ti.com/corp/docs/legal/termsofuse.shtml"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用条款</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font><a href="https://translate.google.com/website?sl=auto&amp;tl=zh-CN&amp;hl=en&amp;client=webapp&amp;u=https://www.ti.com/lsds/ti/legal/termsofsale.page"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">销售条款</font></font></a></p>
       </div>
      </footer>
     </div>
    </div>
   </section>
  </div>
  <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'3.03.01.00',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
  <script type="text/javascript" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/jquery.js.下载"></script>
  <script type="text/javascript" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/underscore.js.下载"></script>
  <script type="text/javascript" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/doctools.js.下载"></script>
  <script type="text/javascript" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/language_data.js.下载"></script>
  <script type="text/javascript" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/theme.js.下载"></script>
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
        });

      var menuHeight = window.innerHeight;

      var contentOffset = $(".wy-nav-content-wrap").offset();
      var contentHeight = $(".wy-nav-content-wrap").height();
      var contentBottom = contentOffset.top + contentHeight;

      function setNavbarTop() {
          var scrollTop = $(window).scrollTop();
          var maxTop = scrollTop + menuHeight;

          // If past the header
          if (scrollTop > contentOffset.top && maxTop < contentBottom) {
            stickyTop = scrollTop - contentOffset.top;
          } else if (maxTop > contentBottom) {
            stickyTop = scrollTop - contentOffset.top - (maxTop - contentBottom);
          } else {
            stickyTop = 0;
          }

          $(".wy-nav-side").css("top", stickyTop);
      }

      $(document).ready(function() {
        setNavbarTop();
        $(window).scroll(function () {
          setNavbarTop();
        });
      });
  </script>
  <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>
  <link rel="stylesheet" type="text/css" href="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/AA9KfQNZ">
  <script src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/VGhPKXQp" async="" defer=""></script>
  <div id="sec-overlay" style="display:none;">
   <div id="sec-container">
   </div>
  </div>
  <script>function gtElInit() {var lib = new google.translate.TranslateService();lib.translatePage('en', 'zh-CN', function () {});}</script>
  <script src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/element.js.下载" type="text/javascript"></script>
 
<style>
    :root {
      /* System tokens */
      --md-sys-typescale-body-medium: system-ui 16px/24px;
      --md-sys-typescale-headline-small: system-ui 24px/32px;

      /* Component tokens */
      --md-dialog-container-shape: 8px;
      --md-dialog-container-color: #ffffff;
      --md-filled-button-container-shape: 4px;
      --md-filled-button-container-color: #1a73e8;
      --md-text-button-container-shape: 4px;
      --md-text-button-container-color: #1a73e8;
      --md-text-button-label-text-color: #1a73e8;
      --md-text-button-focus-label-text-color: #1a73e8;
      --md-text-button-hover-label-text-color: #1a73e8;
      --md-text-button-pressed-label-text-color: #1a73e8;
    }</style><div id="goog-gt-tt" class="VIpgJd-yAWNEb-L7lbkb skiptranslate" style="border-radius: 12px; margin: 0 0 0 -23px; padding: 0; font-family: &#39;Google Sans&#39;, Arial, sans-serif;" data-id=""><div id="goog-gt-vt" class="VIpgJd-yAWNEb-hvhgNd"><div class=" VIpgJd-yAWNEb-hvhgNd-l4eHX-i3jM8c"><img src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/24px(1).svg" width="24" height="24" alt=""></div><div class=" VIpgJd-yAWNEb-hvhgNd-k77Iif-i3jM8c"><div class="VIpgJd-yAWNEb-hvhgNd-IuizWc" dir="ltr">Original text</div><div id="goog-gt-original-text" class="VIpgJd-yAWNEb-nVMfcd-fmcmS VIpgJd-yAWNEb-hvhgNd-axAV1"></div></div><div class="VIpgJd-yAWNEb-hvhgNd-N7Eqid ltr"><div class="VIpgJd-yAWNEb-hvhgNd-N7Eqid-B7I4Od ltr" dir="ltr"><div class="VIpgJd-yAWNEb-hvhgNd-UTujCb">Rate this translation</div><div class="VIpgJd-yAWNEb-hvhgNd-eO9mKe">Your feedback will be used to help improve Google Translate</div></div><div class="VIpgJd-yAWNEb-hvhgNd-xgov5 ltr"><button id="goog-gt-thumbUpButton" type="button" class="VIpgJd-yAWNEb-hvhgNd-bgm6sf" title="Good translation" aria-label="Good translation" aria-pressed="false"><span id="goog-gt-thumbUpIcon"><svg width="24" height="24" viewBox="0 0 24 24" focusable="false" class="VIpgJd-yAWNEb-hvhgNd-THI6Vb NMm5M"><path d="M21 7h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 0S7.08 6.85 7 7H2v13h16c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73V9c0-1.1-.9-2-2-2zM7 18H4V9h3v9zm14-7l-3 7H9V8l4.34-4.34L12 9h9v2z"></path></svg></span><span id="goog-gt-thumbUpIconFilled"><svg width="24" height="24" viewBox="0 0 24 24" focusable="false" class="VIpgJd-yAWNEb-hvhgNd-THI6Vb NMm5M"><path d="M21 7h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 0S7.08 6.85 7 7v13h11c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73V9c0-1.1-.9-2-2-2zM5 7H1v13h4V7z"></path></svg></span></button><button id="goog-gt-thumbDownButton" type="button" class="VIpgJd-yAWNEb-hvhgNd-bgm6sf" title="Poor translation" aria-label="Poor translation" aria-pressed="false"><span id="goog-gt-thumbDownIcon"><svg width="24" height="24" viewBox="0 0 24 24" focusable="false" class="VIpgJd-yAWNEb-hvhgNd-THI6Vb NMm5M"><path d="M3 17h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 24s7.09-6.85 7.17-7h5V4H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2zM17 6h3v9h-3V6zM3 13l3-7h9v10l-4.34 4.34L12 15H3v-2z"></path></svg></span><span id="goog-gt-thumbDownIconFilled"><svg width="24" height="24" viewBox="0 0 24 24" focusable="false" class="VIpgJd-yAWNEb-hvhgNd-THI6Vb NMm5M"><path d="M3 17h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 24s7.09-6.85 7.17-7V4H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2zm16 0h4V4h-4v13z"></path></svg></span></button></div></div><div id="goog-gt-votingHiddenPane" class="VIpgJd-yAWNEb-hvhgNd-aXYTce"><form id="goog-gt-votingForm" action="https://translate.googleapis.com/translate_voting?client=wt_lib" method="post" target="votingFrame" class="VIpgJd-yAWNEb-hvhgNd-aXYTce"><input type="text" name="sl" id="goog-gt-votingInputSrcLang"><input type="text" name="tl" id="goog-gt-votingInputTrgLang"><input type="text" name="query" id="goog-gt-votingInputSrcText"><input type="text" name="gtrans" id="goog-gt-votingInputTrgText"><input type="text" name="vote" id="goog-gt-votingInputVote"></form><iframe name="votingFrame" frameborder="0" src="./RTLS 工具箱 — SimpleLink™ CC2640R2 SDK BLE-Stack 3.xx 3.03.01.00 用户指南 文档_files/saved_resource.html"></iframe></div></div></div><md-dialog type="alert"><template shadowrootmode="open"><!---->
      <div class="scrim"></div>
      <dialog class="has-headline has-actions" role="alertdialog" aria-labelledby="headline">
        <!--?lit$046738375$-->
        <div class="container">
          <div class="headline">
            <div class="icon" aria-hidden="true">
              <slot name="icon"></slot>
            </div>
            <h2 id="headline">
              <slot name="headline"></slot>
            </h2>
            <md-divider><template shadowrootmode="open"><!----></template></md-divider>
          </div>
          <div class="scroller">
            <div class="content">
              <div class="top anchor"></div>
              <slot name="content"></slot>
              <div class="bottom anchor"></div>
            </div>
          </div>
          <div class="actions">
            <md-divider><template shadowrootmode="open"><!----></template></md-divider>
            <slot name="actions"></slot>
          </div>
        </div>
        <!--?lit$046738375$-->
      </dialog>
    </template><div slot="headline"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法支持此表单</font></font></div><form slot="content" id="KucnDc" method="dialog"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了保护您在使用 Google 翻译时的安全，请不要以此类形式提交信息。</font></font></form><div slot="actions"><md-text-button form="KucnDc" value="cancel"><template shadowrootmode="open" shadowrootdelegatesfocus><!---->
      <!--?lit$046738375$-->
      <div class="background"></div>
      <md-focus-ring part="focus-ring" for="button" aria-hidden="true"><template shadowrootmode="open"><!----></template></md-focus-ring>
      <md-ripple part="ripple" for="button" aria-hidden="true"><template shadowrootmode="open"><!----><div class="surface   "></div></template></md-ripple>
      <!--?lit$046738375$--><button id="button" class="button">
      <!--?lit$046738375$-->
      <span class="touch"></span>
      <!--?lit$046738375$--><slot name="icon"></slot>
      <span class="label"><slot></slot></span>
      <!--?lit$046738375$-->
    
    </button>
    </template><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知道了</font></font></md-text-button><md-filled-button form="KucnDc" trailing-icon="" has-icon="" value="submit"><template shadowrootmode="open" shadowrootdelegatesfocus><!---->
      <!--?lit$046738375$--><md-elevation part="elevation" aria-hidden="true"><template shadowrootmode="open"><!----><span class="shadow"></span></template></md-elevation>
      <div class="background"></div>
      <md-focus-ring part="focus-ring" for="link" aria-hidden="true"><template shadowrootmode="open"><!----></template></md-focus-ring>
      <md-ripple part="ripple" for="link" aria-hidden="true"><template shadowrootmode="open"><!----><div class="surface   "></div></template></md-ripple>
      <!--?lit$046738375$--><a id="link" class="button" href="https://software-dl.ti.com/simplelink/esd/simplelink_cc2640r2_sdk/3.30.00.20/exports/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/localization-index.html" target="_blank"><!--?lit$046738375$-->
      <span class="touch"></span>
      <!--?lit$046738375$-->
      <span class="label"><slot></slot></span>
      <!--?lit$046738375$--><slot name="icon"></slot>
    
    </a>
    </template><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至原始 URL</font></font><md-icon slot="icon" translate="no" aria-hidden="true"><template shadowrootmode="open"><!----><slot></slot></template>open_in_new</md-icon></md-filled-button></div></md-dialog></body></html>